<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .upload-area {
            border: 2px dashed #e5e7eb;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }

        .upload-area.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .card-hover {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .health-metric {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .reminder-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .trend-positive {
            color: #10b981;
        }

        .trend-negative {
            color: #ef4444;
        }

        .profile-scroll {
            height: calc(100vh - 64px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .reminders-scroll {
            height: calc(100vh - 64px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 80px;
        }

        .modal-scroll {
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        @media (max-width: 768px) {
            .mobile-stack {
                flex-direction: column;
                gap: 0.5rem;
            }

            .mobile-full-width {
                width: 100%;
            }

            .mobile-text-sm {
                font-size: 0.875rem;
            }

            .mobile-p-2 {
                padding: 0.5rem;
            }

            .mobile-touch-target {
                min-height: 44px;
                min-width: 44px;
            }

            .modal-mobile {
                margin: 1rem;
                max-height: calc(100vh - 2rem);
                width: calc(100vw - 2rem);
            }
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-heartbeat text-white text-sm"></i>
                    </div>
                    <h1 class="text-xl font-semibold text-gray-900">Health Dashboard</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Notification Bell -->
                    <div class="relative">
                        <button onclick="toggleNotifications()"
                            class="p-2 text-gray-400 hover:text-gray-600 rounded-lg relative">
                            <i class="fas fa-bell"></i>
                            <span
                                class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
                        </button>

                        <!-- Notification Dropdown -->
                        <div id="notificationDropdown"
                            class="hidden absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-lg border z-50">
                            <div class="p-4 border-b border-gray-100">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-semibold text-gray-900">Notifications</h3>
                                    <button onclick="markAllRead()"
                                        class="text-sm text-blue-600 hover:text-blue-700">Mark all as read</button>
                                </div>
                            </div>
                            <div class="max-h-96 overflow-y-auto">
                                <div class="p-3 hover:bg-gray-50 border-b border-gray-100 cursor-pointer">
                                    <div class="flex items-start space-x-3">
                                        <div
                                            class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-chart-line text-blue-600 text-xs"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">New Analysis Ready</p>
                                            <p class="text-xs text-gray-600">Your cholesterol report has been analyzed
                                            </p>
                                            <p class="text-xs text-gray-500 mt-1">2 hours ago</p>
                                        </div>
                                        <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                    </div>
                                </div>
                                <div class="p-3 hover:bg-gray-50 border-b border-gray-100 cursor-pointer">
                                    <div class="flex items-start space-x-3">
                                        <div
                                            class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-clock text-yellow-600 text-xs"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Reminder: Blood Pressure Check
                                            </p>
                                            <p class="text-xs text-gray-600">Time for your weekly BP measurement</p>
                                            <p class="text-xs text-gray-500 mt-1">1 day ago</p>
                                        </div>
                                        <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                    </div>
                                </div>
                                <div class="p-3 hover:bg-gray-50 cursor-pointer">
                                    <div class="flex items-start space-x-3">
                                        <div
                                            class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-lightbulb text-green-600 text-xs"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">AI Health Tip</p>
                                            <p class="text-xs text-gray-600">Try Mediterranean diet for better heart
                                                health</p>
                                            <p class="text-xs text-gray-500 mt-1">3 days ago</p>
                                        </div>
                                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 border-t border-gray-100">
                                <button onclick="showAllReminders()"
                                    class="w-full text-center text-sm text-blue-600 hover:text-blue-700 font-medium">
                                    View All Notifications
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Dropdown -->
                    <div class="relative">
                        <button onclick="toggleProfile()"
                            class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center hover:bg-gray-400 transition-colors">
                            <i class="fas fa-user text-gray-600 text-sm"></i>
                        </button>

                        <!-- Profile Dropdown -->
                        <div id="profileDropdown"
                            class="hidden absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-lg border z-50">
                            <div class="p-4 border-b border-gray-100">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user text-blue-600"></i>
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-900">John Doe</p>
                                        <p class="text-sm text-gray-600">john@email.com</p>
                                    </div>
                                </div>
                            </div>
                            <div class="p-2">
                                <button onclick="showProfile()"
                                    class="w-full flex items-center space-x-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg">
                                    <i class="fas fa-user-cog text-gray-500"></i>
                                    <span class="text-sm text-gray-700">Profile Settings</span>
                                </button>
                                <button onclick="showAllReminders()"
                                    class="w-full flex items-center space-x-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg">
                                    <i class="fas fa-bell text-gray-500"></i>
                                    <span class="text-sm text-gray-700">Manage Reminders</span>
                                </button>
                                <button
                                    class="w-full flex items-center space-x-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg">
                                    <i class="fas fa-download text-gray-500"></i>
                                    <span class="text-sm text-gray-700">Export Data</span>
                                </button>
                                <hr class="my-2">
                                <button
                                    class="w-full flex items-center space-x-3 px-3 py-2 text-left hover:bg-gray-50 rounded-lg text-red-600">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span class="text-sm">Sign Out</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Section -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-2">Welcome!</h2>
            <p class="text-gray-600">Get your health overview</p>
        </div>

        <!-- Main Grid Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- File Upload Card -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-sm border card-hover p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">Upload Health Report</h3>
                        <i class="fas fa-upload text-blue-600"></i>
                    </div>

                    <div class="upload-area rounded-lg p-8 text-center cursor-pointer" id="uploadArea">
                        <div class="mb-4">
                            <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                            <p class="text-lg font-medium text-gray-700 mb-2">Drop your files here</p>
                            <p class="text-sm text-gray-500">or click to browse</p>
                        </div>
                        <input type="file" id="fileInput" class="hidden" accept=".pdf,.jpg,.jpeg,.png" multiple>
                        <button onclick="document.getElementById('fileInput').click()"
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Choose Files
                        </button>
                    </div>

                    <div id="filePreview" class="mt-4 hidden">
                        <h4 class="font-medium text-gray-700 mb-2">Selected Files:</h4>
                        <div id="fileList" class="space-y-2"></div>
                        <button onclick="uploadFiles()"
                            class="mt-4 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-check mr-2"></i>Upload & Analyze Reports
                        </button>
                    </div>

                    <!-- Analysis Progress -->
                    <div id="analysisProgress" class="mt-4 hidden">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-center space-x-3">
                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                                <div>
                                    <p class="text-sm font-medium text-blue-900">Analyzing your health report...</p>
                                    <p id="analysisStatus" class="text-xs text-blue-700">Extracting text from
                                        document...</p>
                                </div>
                            </div>
                            <div class="mt-3 bg-blue-200 rounded-full h-2">
                                <div id="analysisProgressBar"
                                    class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Analysis Results -->
                    <div id="analysisResults" class="mt-4 hidden">
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-900">Analysis Results</h4>
                                <button onclick="downloadAnalysis()"
                                    class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                                    <i class="fas fa-download mr-1"></i>Download Report
                                </button>
                            </div>
                            <div id="analysisContent"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reminder Box -->
            <div class="bg-white rounded-xl shadow-sm border card-hover">
                <div class="reminder-card rounded-xl p-6 text-white">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Health Reminders</h3>
                        <i class="fas fa-bell"></i>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 bg-white rounded-full"></div>
                            <span class="text-sm">Blood pressure check - Today</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 bg-white rounded-full"></div>
                            <span class="text-sm">Medication refill - 3 days</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="w-2 h-2 bg-white rounded-full"></div>
                            <span class="text-sm">Annual checkup - 2 weeks</span>
                        </div>
                    </div>
                    <button onclick="showAllReminders()"
                        class="mt-4 bg-white bg-opacity-20 text-white px-4 py-2 rounded-lg hover:bg-opacity-30 transition-colors text-sm">
                        View All Reminders
                    </button>
                </div>
            </div>
        </div>

        <!-- Report Comparison Section -->
        <div class="bg-white rounded-xl shadow-sm border card-hover p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Report Comparison</h3>
                <div class="flex items-center space-x-2 text-sm text-gray-600">
                    <span>Current vs Previous</span>
                    <i class="fas fa-exchange-alt"></i>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Cholesterol</span>
                        <div class="flex items-center text-green-600">
                            <i class="fas fa-arrow-down text-xs mr-1"></i>
                            <span class="text-xs">-8%</span>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Current:</span>
                            <span class="font-semibold text-gray-900">185 mg/dL</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Previous:</span>
                            <span class="text-gray-500">201 mg/dL</span>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Blood Pressure</span>
                        <div class="flex items-center text-green-600">
                            <i class="fas fa-arrow-down text-xs mr-1"></i>
                            <span class="text-xs">-3%</span>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Current:</span>
                            <span class="font-semibold text-gray-900">120/80</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Previous:</span>
                            <span class="text-gray-500">124/82</span>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Blood Sugar</span>
                        <div class="flex items-center text-blue-600">
                            <i class="fas fa-minus text-xs mr-1"></i>
                            <span class="text-xs">0%</span>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Current:</span>
                            <span class="font-semibold text-gray-900">95 mg/dL</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Previous:</span>
                            <span class="text-gray-500">95 mg/dL</span>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">BMI</span>
                        <div class="flex items-center text-red-600">
                            <i class="fas fa-arrow-up text-xs mr-1"></i>
                            <span class="text-xs">+2%</span>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Current:</span>
                            <span class="font-semibold text-gray-900">22.4</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Previous:</span>
                            <span class="text-gray-500">22.0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-sm border card-hover p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">Blood Pressure</p>
                        <p class="text-2xl font-bold text-gray-900">120/80</p>
                        <p class="text-sm trend-positive"><i class="fas fa-arrow-down mr-1"></i>Normal</p>
                    </div>
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-heart text-green-600"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border card-hover p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">Cholesterol</p>
                        <p class="text-2xl font-bold text-gray-900">185 mg/dL</p>
                        <p class="text-sm trend-positive"><i class="fas fa-arrow-down mr-1"></i>Good</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-chart-line text-blue-600"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border card-hover p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">Blood Sugar</p>
                        <p class="text-2xl font-bold text-gray-900">95 mg/dL</p>
                        <p class="text-sm trend-positive"><i class="fas fa-check mr-1"></i>Normal</p>
                    </div>
                    <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-tint text-yellow-600"></i>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border card-hover p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">BMI</p>
                        <p class="text-2xl font-bold text-gray-900">22.4</p>
                        <p class="text-sm trend-positive"><i class="fas fa-check mr-1"></i>Healthy</p>
                    </div>
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-weight text-purple-600"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Test Parameters -->
        <div class="bg-white rounded-xl shadow-sm border card-hover p-6 mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-6">Detailed Test Parameters</h3>

            <!-- Cholesterol Panel -->
            <div class="border border-gray-200 rounded-lg mb-4">
                <button onclick="toggleSection('cholesterol')"
                    class="w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-chart-line text-blue-600"></i>
                        </div>
                        <div class="text-left">
                            <h4 class="font-semibold text-gray-900">Cholesterol Panel</h4>
                            <p class="text-sm text-gray-600">Total: 185 mg/dL - Good</p>
                        </div>
                    </div>
                    <i class="fas fa-chevron-down text-gray-400 transform transition-transform"
                        id="cholesterol-icon"></i>
                </button>
                <div id="cholesterol-content" class="hidden border-t border-gray-200 p-4 bg-gray-50">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Total Cholesterol:</span>
                                <span class="text-sm font-medium">185 mg/dL</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">LDL (Bad):</span>
                                <span class="text-sm font-medium">110 mg/dL</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">HDL (Good):</span>
                                <span class="text-sm font-medium">55 mg/dL</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Triglycerides:</span>
                                <span class="text-sm font-medium">100 mg/dL</span>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-3">
                            <h5 class="font-medium text-gray-900 mb-2">Explanation</h5>
                            <p class="text-sm text-gray-700">Your cholesterol levels are within the desirable range.
                                Total cholesterol below 200 mg/dL is considered good. Continue with heart-healthy diet
                                and regular exercise.</p>
                        </div>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-3 border-l-4 border-blue-400">
                        <h5 class="font-medium text-blue-900 mb-1">Doctor's Note</h5>
                        <p class="text-sm text-blue-800">Excellent improvement from last visit. Patient shows good
                            compliance with dietary recommendations. Continue current lifestyle modifications.</p>
                        <p class="text-xs text-blue-600 mt-2">- Dr. Smith, Cardiologist</p>
                    </div>
                </div>
            </div>

            <!-- Blood Pressure -->
            <div class="border border-gray-200 rounded-lg mb-4">
                <button onclick="toggleSection('bloodpressure')"
                    class="w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-heart text-green-600"></i>
                        </div>
                        <div class="text-left">
                            <h4 class="font-semibold text-gray-900">Blood Pressure</h4>
                            <p class="text-sm text-gray-600">120/80 mmHg - Normal</p>
                        </div>
                    </div>
                    <i class="fas fa-chevron-down text-gray-400 transform transition-transform"
                        id="bloodpressure-icon"></i>
                </button>
                <div id="bloodpressure-content" class="hidden border-t border-gray-200 p-4 bg-gray-50">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Systolic:</span>
                                <span class="text-sm font-medium">120 mmHg</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Diastolic:</span>
                                <span class="text-sm font-medium">80 mmHg</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Heart Rate:</span>
                                <span class="text-sm font-medium">72 bpm</span>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-3">
                            <h5 class="font-medium text-gray-900 mb-2">Explanation</h5>
                            <p class="text-sm text-gray-700">Your blood pressure is in the normal range. Systolic below
                                120 and diastolic below 80 indicates good cardiovascular health.</p>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-3 border-l-4 border-green-400">
                        <h5 class="font-medium text-green-900 mb-1">Doctor's Note</h5>
                        <p class="text-sm text-green-800">Blood pressure remains stable and within optimal range.
                            Continue current exercise routine and low-sodium diet.</p>
                        <p class="text-xs text-green-600 mt-2">- Dr. Johnson, Internal Medicine</p>
                    </div>
                </div>
            </div>

            <!-- Blood Sugar -->
            <div class="border border-gray-200 rounded-lg">
                <button onclick="toggleSection('bloodsugar')"
                    class="w-full flex items-center justify-between p-4 hover:bg-gray-50 transition-colors">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-tint text-yellow-600"></i>
                        </div>
                        <div class="text-left">
                            <h4 class="font-semibold text-gray-900">Blood Sugar</h4>
                            <p class="text-sm text-gray-600">95 mg/dL - Normal</p>
                        </div>
                    </div>
                    <i class="fas fa-chevron-down text-gray-400 transform transition-transform"
                        id="bloodsugar-icon"></i>
                </button>
                <div id="bloodsugar-content" class="hidden border-t border-gray-200 p-4 bg-gray-50">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">Fasting Glucose:</span>
                                <span class="text-sm font-medium">95 mg/dL</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-sm text-gray-600">HbA1c:</span>
                                <span class="text-sm font-medium">5.2%</span>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-3">
                            <h5 class="font-medium text-gray-900 mb-2">Explanation</h5>
                            <p class="text-sm text-gray-700">Your blood sugar levels are normal. Fasting glucose below
                                100 mg/dL and HbA1c below 5.7% indicate good glucose control.</p>
                        </div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-3 border-l-4 border-yellow-400">
                        <h5 class="font-medium text-yellow-900 mb-1">Doctor's Note</h5>
                        <p class="text-sm text-yellow-800">Blood sugar levels are well-controlled. Continue balanced
                            diet and regular monitoring. No signs of pre-diabetes.</p>
                        <p class="text-xs text-yellow-600 mt-2">- Dr. Williams, Endocrinologist</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Trend Graph -->
        <div class="bg-white rounded-xl shadow-sm border card-hover p-6">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">Health Trends</h3>
                <div class="flex space-x-2">
                    <button onclick="updateChart('cholesterol')"
                        class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors">
                        Cholesterol
                    </button>
                    <button onclick="updateChart('bloodPressure')"
                        class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                        Blood Pressure
                    </button>
                    <button onclick="updateChart('bloodSugar')"
                        class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                        Blood Sugar
                    </button>
                </div>
            </div>
            <div class="h-64">
                <canvas id="healthChart"></canvas>
            </div>
        </div>

        <!-- AI Health Chat Interface -->
        <div class="mt-8 bg-white rounded-xl shadow-sm border card-hover">
            <div class="flex items-center justify-between p-6 border-b border-gray-100">
                <div class="flex items-center space-x-3">
                    <div
                        class="w-10 h-10 bg-gradient-to-r from-blue-500 to-teal-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-user-md text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Dr. AI Assistant</h3>
                        <p class="text-sm text-green-600 flex items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            Online
                        </p>
                    </div>
                </div>
                <button onclick="clearChat()"
                    class="text-gray-400 hover:text-gray-600 p-2 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-trash text-sm"></i>
                </button>
            </div>

            <!-- Chat Messages Area -->
            <div id="chatMessages" class="h-96 overflow-y-auto p-6 space-y-4 bg-gray-50">
                <!-- Welcome Message -->
                <div class="flex items-start space-x-3">
                    <div
                        class="w-8 h-8 bg-gradient-to-r from-blue-500 to-teal-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-user-md text-white text-xs"></i>
                    </div>
                    <div class="bg-white rounded-2xl rounded-tl-sm p-4 shadow-sm max-w-xs">
                        <p class="text-sm text-gray-800">Hello! I'm your AI health assistant. I can help answer
                            questions about your health data, provide wellness tips, and offer personalized advice. What
                            would you like to know?</p>
                        <span class="text-xs text-gray-500 mt-2 block">Just now</span>
                    </div>
                </div>

                <!-- Quick Suggestion Buttons -->
                <div class="flex flex-wrap gap-2 ml-11">
                    <button onclick="askQuestion('How can I improve my cholesterol levels?')"
                        class="bg-blue-100 text-blue-700 px-3 py-2 rounded-full text-sm hover:bg-blue-200 transition-colors">
                        üíä Improve cholesterol
                    </button>
                    <button onclick="askQuestion('What exercises are good for my heart?')"
                        class="bg-green-100 text-green-700 px-3 py-2 rounded-full text-sm hover:bg-green-200 transition-colors">
                        ‚ù§Ô∏è Heart exercises
                    </button>
                    <button onclick="askQuestion('How often should I check my blood pressure?')"
                        class="bg-purple-100 text-purple-700 px-3 py-2 rounded-full text-sm hover:bg-purple-200 transition-colors">
                        ü©∫ Blood pressure
                    </button>
                </div>
            </div>

            <!-- Chat Input Area -->
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-xl">
                <div class="flex items-center space-x-3">
                    <div class="flex-1 relative">
                        <input type="text" id="chatInput" placeholder="Ask me anything about your health..."
                            class="w-full px-4 py-3 pr-12 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            onkeypress="handleKeyPress(event)">
                        <button onclick="sendMessage()"
                            class="absolute right-2 top-1/2 transform -translate-y-1/2 w-8 h-8 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors flex items-center justify-center">
                            <i class="fas fa-paper-plane text-xs"></i>
                        </button>
                    </div>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-center">
                    <i class="fas fa-info-circle mr-1"></i>
                    This AI provides general health information and is not a substitute for professional medical advice.
                </p>
            </div>
        </div>
    </div>

    <!-- Profile Settings Page (Redesigned with Full Scrolling) -->
    <div id="profilePage" class="hidden fixed inset-0 bg-gray-100 z-40">
        <!-- Sticky Header -->
        <div class="sticky top-0 bg-white shadow-sm border-b z-50">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-4">
                        <button onclick="hideProfile()"
                            class="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                            <i class="fas fa-arrow-left text-lg"></i>
                        </button>
                        <div>
                            <h2 class="text-xl font-bold text-gray-900">Profile Settings</h2>
                            <p class="text-sm text-gray-600">Manage your account and preferences</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-blue-600"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-medium text-gray-900">John Doe</p>
                            <p class="text-xs text-gray-500">Premium Member</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scrollable Content -->
        <div class="profile-scroll">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6">

                <!-- Personal Information Card -->
                <div class="bg-white rounded-xl shadow-sm border p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-blue-600"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Personal Information</h3>
                                <p class="text-sm text-gray-600">Update your basic profile details</p>
                            </div>
                        </div>
                        <button class="text-blue-600 hover:text-blue-700 text-sm font-medium">Edit</button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                            <input type="text" value="John Doe"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" value="test@email.com"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" value="+1 (555) 123-4567"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date of Birth</label>
                            <input type="date" value="1992-03-15"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                            <select
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option>Female</option>
                                <option>Male</option>
                                <option>Other</option>
                                <option>Prefer not to say</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Emergency Contact</label>
                            <input type="text" value="John Johnson - +1 (555) 987-6543"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>

                    <div class="mt-6 flex justify-end">
                        <button
                            class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                            Save Changes
                        </button>
                    </div>
                </div>

                <!-- Health Preferences Card -->
                <div class="bg-white rounded-xl shadow-sm border p-6">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-cog text-green-600"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Health Preferences</h3>
                            <p class="text-sm text-gray-600">Customize your health tracking settings</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Preferred Language</label>
                            <select
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option>English</option>
                                <option>Spanish</option>
                                <option>French</option>
                                <option>German</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Measurement Units</label>
                            <select
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option>Imperial (mg/dL, lbs, ¬∞F)</option>
                                <option>Metric (mmol/L, kg, ¬∞C)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Reminder Frequency</label>
                            <select
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option>Daily</option>
                                <option>Weekly</option>
                                <option>Monthly</option>
                                <option>Custom</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Time Zone</label>
                            <select
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option>Eastern Time (ET)</option>
                                <option>Central Time (CT)</option>
                                <option>Mountain Time (MT)</option>
                                <option>Pacific Time (PT)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Notification Preferences -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="font-medium text-gray-900 mb-4">Notification Preferences</h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Email Notifications</p>
                                    <p class="text-xs text-gray-600">Receive health reminders and updates via email</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div
                                        class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                    </div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-900">SMS Reminders</p>
                                    <p class="text-xs text-gray-600">Get text message reminders for appointments</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div
                                        class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                    </div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-900">Push Notifications</p>
                                    <p class="text-xs text-gray-600">Browser notifications for urgent health alerts</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer">
                                    <div
                                        class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Health Goals Card -->
                <div class="bg-white rounded-xl shadow-sm border p-6">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-target text-purple-600"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Health Goals</h3>
                            <p class="text-sm text-gray-600">Set and track your health objectives</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-medium text-gray-900">Lower Cholesterol</h4>
                                <span class="text-sm text-green-600 font-medium">On Track</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">Target: Below 180 mg/dL | Current: 185 mg/dL</p>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-green-500 h-2 rounded-full" style="width: 85%"></div>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-medium text-gray-900">Maintain Healthy Weight</h4>
                                <span class="text-sm text-blue-600 font-medium">Achieved</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">Target BMI: 18.5-24.9 | Current: 22.4</p>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: 100%"></div>
                            </div>
                        </div>

                        <button
                            class="w-full border-2 border-dashed border-gray-300 rounded-lg p-4 text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add New Health Goal
                        </button>
                    </div>
                </div>

                <!-- Report History Card -->
                <div class="bg-white rounded-xl shadow-sm border p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-file-medical text-orange-600"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Report History</h3>
                                <p class="text-sm text-gray-600">View and manage your uploaded health reports</p>
                            </div>
                        </div>
                        <button class="text-blue-600 hover:text-blue-700 text-sm font-medium">View All</button>
                    </div>

                    <div class="space-y-4">
                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors gap-3">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-file-pdf text-red-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900">Comprehensive Metabolic Panel</p>
                                    <p class="text-sm text-gray-600">Uploaded June 15, 2024 ‚Ä¢ 2.3 MB</p>
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:space-x-2">
                                <button
                                    class="text-blue-600 hover:text-blue-700 text-sm font-medium py-2 px-3 rounded border border-blue-200 hover:bg-blue-50 mobile-touch-target">View</button>
                                <button
                                    class="text-gray-500 hover:text-gray-700 text-sm py-2 px-3 rounded border border-gray-200 hover:bg-gray-50 mobile-touch-target">Download</button>
                                <button
                                    class="text-red-500 hover:text-red-700 text-sm py-2 px-3 rounded border border-red-200 hover:bg-red-50 mobile-touch-target">Delete</button>
                            </div>
                        </div>

                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors gap-3">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-file-pdf text-red-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900">Lipid Panel Results</p>
                                    <p class="text-sm text-gray-600">Uploaded May 22, 2024 ‚Ä¢ 1.8 MB</p>
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:space-x-2">
                                <button
                                    class="text-blue-600 hover:text-blue-700 text-sm font-medium py-2 px-3 rounded border border-blue-200 hover:bg-blue-50 mobile-touch-target">View</button>
                                <button
                                    class="text-gray-500 hover:text-gray-700 text-sm py-2 px-3 rounded border border-gray-200 hover:bg-gray-50 mobile-touch-target">Download</button>
                                <button
                                    class="text-red-500 hover:text-red-700 text-sm py-2 px-3 rounded border border-red-200 hover:bg-red-50 mobile-touch-target">Delete</button>
                            </div>
                        </div>

                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors gap-3">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-file-image text-blue-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900">Blood Pressure Log</p>
                                    <p class="text-sm text-gray-600">Uploaded April 10, 2024 ‚Ä¢ 0.9 MB</p>
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:space-x-2">
                                <button
                                    class="text-blue-600 hover:text-blue-700 text-sm font-medium py-2 px-3 rounded border border-blue-200 hover:bg-blue-50 mobile-touch-target">View</button>
                                <button
                                    class="text-gray-500 hover:text-gray-700 text-sm py-2 px-3 rounded border border-gray-200 hover:bg-gray-50 mobile-touch-target">Download</button>
                                <button
                                    class="text-red-500 hover:text-red-700 text-sm py-2 px-3 rounded border border-red-200 hover:bg-red-50 mobile-touch-target">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Privacy & Security Card -->
                <div class="bg-white rounded-xl shadow-sm border p-6">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-shield-alt text-red-600"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Privacy & Security</h3>
                            <p class="text-sm text-gray-600">Manage your account security and privacy settings</p>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 border border-gray-200 rounded-lg gap-3">
                            <div>
                                <p class="font-medium text-gray-900">Change Password</p>
                                <p class="text-sm text-gray-600">Update your account password</p>
                            </div>
                            <button
                                class="text-blue-600 hover:text-blue-700 font-medium py-2 px-4 rounded border border-blue-200 hover:bg-blue-50 mobile-touch-target">Change</button>
                        </div>

                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 border border-gray-200 rounded-lg gap-3">
                            <div>
                                <p class="font-medium text-gray-900">Two-Factor Authentication</p>
                                <p class="text-sm text-gray-600">Add an extra layer of security</p>
                            </div>
                            <button
                                class="bg-green-100 text-green-700 px-4 py-2 rounded-full text-sm font-medium mobile-touch-target">Enabled</button>
                        </div>

                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 border border-gray-200 rounded-lg gap-3">
                            <div>
                                <p class="font-medium text-gray-900">Data Export</p>
                                <p class="text-sm text-gray-600">Download all your health data</p>
                            </div>
                            <button
                                class="text-blue-600 hover:text-blue-700 font-medium py-2 px-4 rounded border border-blue-200 hover:bg-blue-50 mobile-touch-target">Export</button>
                        </div>

                        <div
                            class="flex flex-col sm:flex-row sm:items-center justify-between p-4 border border-red-200 rounded-lg bg-red-50 gap-3">
                            <div>
                                <p class="font-medium text-red-900">Delete Account</p>
                                <p class="text-sm text-red-700">Permanently delete your account and all data</p>
                            </div>
                            <button
                                class="text-red-600 hover:text-red-700 font-medium py-2 px-4 rounded border border-red-200 hover:bg-red-100 mobile-touch-target">Delete</button>
                        </div>
                    </div>
                </div>

                <!-- Account Actions Card -->
                <div class="bg-white rounded-xl shadow-sm border p-6">
                    <div class="flex items-center space-x-3 mb-6">
                        <div class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-cogs text-gray-600"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Account Actions</h3>
                            <p class="text-sm text-gray-600">Quick actions for your account</p>
                        </div>
                    </div>

                    <div class="flex flex-col gap-3">
                        <button
                            class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium mobile-touch-target">
                            <i class="fas fa-save mr-2"></i>Save All Changes
                        </button>
                        <button
                            class="w-full bg-gray-200 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-300 transition-colors font-medium mobile-touch-target">
                            <i class="fas fa-undo mr-2"></i>Reset to Default
                        </button>
                        <button
                            class="w-full bg-red-600 text-white py-3 px-6 rounded-lg hover:bg-red-700 transition-colors font-medium mobile-touch-target">
                            <i class="fas fa-sign-out-alt mr-2"></i>Sign Out
                        </button>
                    </div>
                </div>

                <!-- Footer Spacing -->
                <div class="h-20 md:h-8"></div>
            </div>
        </div>

        <!-- Mobile Bottom Navigation -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 md:hidden z-30">
            <div class="flex items-center justify-around py-2">
                <button onclick="hideProfile(); hideReminders();"
                    class="flex flex-col items-center py-2 px-3 text-gray-600 hover:text-blue-600 mobile-touch-target">
                    <i class="fas fa-home text-lg mb-1"></i>
                    <span class="text-xs">Dashboard</span>
                </button>
                <button onclick="showAllReminders()"
                    class="flex flex-col items-center py-2 px-3 text-gray-600 hover:text-blue-600 mobile-touch-target">
                    <i class="fas fa-bell text-lg mb-1"></i>
                    <span class="text-xs">Reminders</span>
                </button>
                <button onclick="openReminderModal()"
                    class="flex flex-col items-center py-2 px-3 text-white bg-blue-600 rounded-lg mx-2 mobile-touch-target">
                    <i class="fas fa-plus text-lg mb-1"></i>
                    <span class="text-xs">Add</span>
                </button>
                <button onclick="showProfile()"
                    class="flex flex-col items-center py-2 px-3 text-gray-600 hover:text-blue-600 mobile-touch-target">
                    <i class="fas fa-user text-lg mb-1"></i>
                    <span class="text-xs">Profile</span>
                </button>
                <button onclick="toggleNotifications()"
                    class="flex flex-col items-center py-2 px-3 text-gray-600 hover:text-blue-600 mobile-touch-target relative">
                    <i class="fas fa-bell text-lg mb-1"></i>
                    <span class="text-xs">Alerts</span>
                    <span
                        class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Add Reminder Modal -->
    <div id="reminderModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full modal-scroll modal-mobile">
            <!-- Modal Header -->
            <div
                class="flex items-center justify-between p-6 border-b border-gray-200 sticky top-0 bg-white rounded-t-xl z-10">
                <div class="flex items-center space-x-3">
                    <h3 class="text-lg font-semibold text-gray-900">Add New Reminder</h3>
                    <div class="flex items-center space-x-2">
                        <button onclick="useTemplate('monthly-checkup')"
                            class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full hover:bg-blue-200">
                            üìã Templates
                        </button>
                    </div>
                </div>
                <button onclick="closeReminderModal()" class="text-gray-400 hover:text-gray-600 p-1">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>

            <!-- Template Dropdown -->
            <div id="templateDropdown" class="hidden bg-blue-50 border-b border-blue-200 p-4">
                <h4 class="text-sm font-medium text-blue-900 mb-3">Quick Templates</h4>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="applyTemplate('monthly-checkup')"
                        class="text-left p-3 bg-white rounded-lg hover:bg-blue-100 transition-colors">
                        <div class="font-medium text-sm text-gray-900">üè• Monthly Checkup</div>
                        <div class="text-xs text-gray-600">Doctor visit + blood work</div>
                    </button>
                    <button onclick="applyTemplate('daily-medicine')"
                        class="text-left p-3 bg-white rounded-lg hover:bg-blue-100 transition-colors">
                        <div class="font-medium text-sm text-gray-900">üíä Daily Medicine</div>
                        <div class="text-xs text-gray-600">Morning medication routine</div>
                    </button>
                    <button onclick="applyTemplate('weekly-exercise')"
                        class="text-left p-3 bg-white rounded-lg hover:bg-blue-100 transition-colors">
                        <div class="font-medium text-sm text-gray-900">üßò Weekly Exercise</div>
                        <div class="text-xs text-gray-600">Fitness routine reminder</div>
                    </button>
                    <button onclick="applyTemplate('lab-test')"
                        class="text-left p-3 bg-white rounded-lg hover:bg-blue-100 transition-colors">
                        <div class="font-medium text-sm text-gray-900">üß™ Lab Test</div>
                        <div class="text-xs text-gray-600">Blood work + prep tasks</div>
                    </button>
                </div>
            </div>

            <!-- Modal Body -->
            <form id="reminderForm" class="p-6 space-y-6">
                <!-- Basic Information -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Reminder Title -->
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Reminder Title</label>
                        <input type="text" id="reminderTitle" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Enter reminder title">
                    </div>

                    <!-- Reminder Type -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                        <select id="reminderType" required onchange="updateTypeIcon()"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">Select type</option>
                            <option value="test">üß™ Health Test</option>
                            <option value="medicine">üíä Medicine</option>
                            <option value="lifestyle">üßò Lifestyle</option>
                            <option value="appointment">üè• Appointment</option>
                        </select>
                    </div>

                    <!-- Priority -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <label
                                class="flex-1 flex items-center justify-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 mobile-touch-target">
                                <input type="radio" name="priority" value="low" checked class="sr-only">
                                <span class="text-sm text-gray-700">üü¢ Low</span>
                            </label>
                            <label
                                class="flex-1 flex items-center justify-center p-3 border rounded-lg cursor-pointer hover:bg-yellow-50 mobile-touch-target">
                                <input type="radio" name="priority" value="medium" class="sr-only">
                                <span class="text-sm text-yellow-700">üü° Medium</span>
                            </label>
                            <label
                                class="flex-1 flex items-center justify-center p-3 border rounded-lg cursor-pointer hover:bg-red-50 mobile-touch-target">
                                <input type="radio" name="priority" value="high" class="sr-only">
                                <span class="text-sm text-red-700">üî¥ High</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Date & Time -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" id="reminderDate" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                        <input type="time" id="reminderTime" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>

                <!-- Recurrence & Advanced Options -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <div>
                            <h4 class="font-medium text-gray-900">Recurring Reminder</h4>
                            <p class="text-sm text-gray-600">Set up automatic repeat</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="recurrenceToggle" class="sr-only peer"
                                onchange="toggleRecurrence()">
                            <div
                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                            </div>
                        </label>
                    </div>

                    <div id="recurrenceOptions" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Frequency</label>
                            <select id="reminderFrequency"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">End Date (Optional)</label>
                            <input type="date" id="recurrenceEndDate"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                </div>

                <!-- Two-Step Alerts -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-yellow-50 rounded-lg">
                        <div>
                            <h4 class="font-medium text-gray-900">Two-Step Alerts</h4>
                            <p class="text-sm text-gray-600">Get notified before the due date</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="twoStepToggle" class="sr-only peer" onchange="toggleTwoStep()">
                            <div
                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-yellow-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-500">
                            </div>
                        </label>
                    </div>

                    <div id="twoStepOptions" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">First Alert</label>
                            <select id="firstAlert"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="72">72 hours before</option>
                                <option value="48">48 hours before</option>
                                <option value="24">24 hours before</option>
                                <option value="12">12 hours before</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Second Alert</label>
                            <select id="secondAlert"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="24">24 hours before</option>
                                <option value="12">12 hours before</option>
                                <option value="6">6 hours before</option>
                                <option value="1">1 hour before</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Location-Based Reminder -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                        <div>
                            <h4 class="font-medium text-gray-900">Location-Based Reminder</h4>
                            <p class="text-sm text-gray-600">Trigger when arriving/leaving a location</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="locationToggle" class="sr-only peer" onchange="toggleLocation()">
                            <div
                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600">
                            </div>
                        </label>
                    </div>

                    <div id="locationOptions" class="hidden space-y-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                            <input type="text" id="reminderLocation"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="Enter address or location name">
                        </div>

                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="locationTrigger" value="arrive" checked
                                    class="text-green-600 focus:ring-green-500">
                                <span class="ml-2 text-sm text-gray-700">On arrival</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="locationTrigger" value="leave"
                                    class="text-green-600 focus:ring-green-500">
                                <span class="ml-2 text-sm text-gray-700">On departure</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Subtasks -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <h4 class="font-medium text-gray-900">Subtasks (Optional)</h4>
                        <button type="button" onclick="addSubtask()"
                            class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                            <i class="fas fa-plus mr-1"></i>Add Subtask
                        </button>
                    </div>

                    <div id="subtasksList" class="space-y-2">
                        <!-- Subtasks will be added here dynamically -->
                    </div>
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description (Optional)</label>
                    <textarea id="reminderDescription" rows="3"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                        placeholder="Add any additional notes..."></textarea>
                </div>
            </form>

            <!-- Modal Footer -->
            <div
                class="flex flex-col sm:flex-row items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl sticky bottom-0">
                <button onclick="closeReminderModal()"
                    class="w-full sm:w-auto px-4 py-3 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors mobile-touch-target">
                    Cancel
                </button>
                <button onclick="saveReminder()"
                    class="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mobile-touch-target">
                    <i class="fas fa-save mr-2"></i>Save Reminder
                </button>
            </div>
        </div>
    </div>

    <!-- All Reminders Page (Hidden by default) -->
    <div id="remindersPage" class="hidden fixed inset-0 bg-gray-50 z-40">
        <!-- Sticky Header -->
        <div class="sticky top-0 bg-white shadow-sm border-b z-50">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <h2 class="text-2xl font-bold text-gray-900">Manage Reminders</h2>
                    <div class="flex items-center space-x-4">
                        <button onclick="openReminderModal()"
                            class="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm md:text-base md:px-4 md:py-3">
                            <i class="fas fa-plus mr-1 md:mr-2"></i><span class="hidden sm:inline">Add </span>Reminder
                        </button>
                        <button onclick="hideReminders()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scrollable Content -->
        <div class="reminders-scroll">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <!-- Enhanced Filter Section -->
                <div class="flex flex-col gap-4 mb-6">
                    <!-- Filter Tabs -->
                    <div class="flex flex-wrap gap-1 bg-gray-100 p-1 rounded-lg w-full overflow-x-auto">
                        <button onclick="filterReminders('all')"
                            class="px-3 py-2 rounded-md text-xs md:text-sm font-medium bg-white text-gray-900 shadow-sm whitespace-nowrap mobile-touch-target">All</button>
                        <button onclick="filterReminders('test')"
                            class="px-3 py-2 rounded-md text-xs md:text-sm font-medium text-gray-600 hover:text-gray-900 whitespace-nowrap mobile-touch-target">üß™
                            Tests</button>
                        <button onclick="filterReminders('medicine')"
                            class="px-3 py-2 rounded-md text-xs md:text-sm font-medium text-gray-600 hover:text-gray-900 whitespace-nowrap mobile-touch-target">üíä
                            Medicine</button>
                        <button onclick="filterReminders('lifestyle')"
                            class="px-3 py-2 rounded-md text-xs md:text-sm font-medium text-gray-600 hover:text-gray-900 whitespace-nowrap mobile-touch-target">üßò
                            Lifestyle</button>
                        <button onclick="filterReminders('appointment')"
                            class="px-3 py-2 rounded-md text-xs md:text-sm font-medium text-gray-600 hover:text-gray-900 whitespace-nowrap mobile-touch-target">üè•
                            Appointments</button>
                    </div>

                    <!-- Status & View Controls -->
                    <div class="flex flex-col md:flex-row md:items-center gap-3 md:gap-4">
                        <!-- Status Filter -->
                        <div class="flex items-center space-x-2 mobile-full-width">
                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">Status:</label>
                            <select id="statusFilter" onchange="filterByStatus()"
                                class="flex-1 md:flex-none px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 mobile-touch-target">
                                <option value="all">All</option>
                                <option value="upcoming">Upcoming</option>
                                <option value="today">Today</option>
                                <option value="overdue">Overdue</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>

                        <!-- View Toggle -->
                        <div class="flex items-center space-x-2 mobile-full-width">
                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">View:</label>
                            <div class="flex bg-gray-100 rounded-lg p-1 flex-1 md:flex-none">
                                <button onclick="toggleView('grid')" id="gridViewBtn"
                                    class="flex-1 px-3 py-1 rounded-md text-sm font-medium bg-white text-gray-900 shadow-sm mobile-touch-target">
                                    <i class="fas fa-th mr-1"></i>Grid
                                </button>
                                <button onclick="toggleView('list')" id="listViewBtn"
                                    class="flex-1 px-3 py-1 rounded-md text-sm font-medium text-gray-600 hover:text-gray-900 mobile-touch-target">
                                    <i class="fas fa-list mr-1"></i>List
                                </button>
                            </div>
                        </div>

                        <!-- Sort Options -->
                        <div class="flex items-center space-x-2 mobile-full-width">
                            <label class="text-sm font-medium text-gray-700 whitespace-nowrap">Sort:</label>
                            <select id="sortFilter" onchange="sortReminders()"
                                class="flex-1 md:flex-none px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 mobile-touch-target">
                                <option value="date-asc">Date (Earliest)</option>
                                <option value="date-desc">Date (Latest)</option>
                                <option value="priority">Priority</option>
                                <option value="type">Type</option>
                                <option value="title">Title A-Z</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Reminders Container -->
                <div id="remindersContainer">
                    <!-- Grid View (Default) -->
                    <div id="gridView" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                        <!-- Enhanced Reminder Cards -->
                        <div class="bg-white rounded-xl shadow-sm border hover:shadow-md transition-shadow duration-200 overflow-hidden"
                            data-type="test" data-status="today" data-priority="high">
                            <div class="p-6">
                                <!-- Header with Priority Indicator -->
                                <div class="flex items-start justify-between mb-4">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                            <span class="text-lg">üß™</span>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-900">Blood Pressure Check</h3>
                                            <div class="flex items-center space-x-2 mt-1">
                                                <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                                                <span class="text-xs text-red-600 font-medium">High Priority</span>
                                            </div>
                                        </div>
                                    </div>
                                    <span
                                        class="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full font-medium">Today</span>
                                </div>

                                <!-- Details -->
                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-clock mr-2 w-4"></i>
                                        <span>2:00 PM</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-repeat mr-2 w-4"></i>
                                        <span>Weekly</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-map-marker-alt mr-2 w-4"></i>
                                        <span>Home</span>
                                    </div>
                                    <p class="text-sm text-gray-700 mt-2">Weekly blood pressure monitoring with home
                                        device</p>
                                </div>

                                <!-- Subtasks -->
                                <div class="mb-4">
                                    <div class="text-xs font-medium text-gray-700 mb-2">Subtasks:</div>
                                    <div class="space-y-1">
                                        <div class="flex items-center text-xs text-gray-600">
                                            <input type="checkbox" class="mr-2 rounded" checked>
                                            <span class="line-through">Prepare BP monitor</span>
                                        </div>
                                        <div class="flex items-center text-xs text-gray-600">
                                            <input type="checkbox" class="mr-2 rounded">
                                            <span>Take measurement</span>
                                        </div>
                                        <div class="flex items-center text-xs text-gray-600">
                                            <input type="checkbox" class="mr-2 rounded">
                                            <span>Record results</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div class="flex flex-col sm:flex-row gap-2">
                                    <button onclick="markReminderDone(1)"
                                        class="flex-1 bg-green-600 text-white py-3 px-3 rounded-lg text-sm hover:bg-green-700 transition-colors mobile-touch-target">
                                        <i class="fas fa-check mr-1"></i>Done
                                    </button>
                                    <button onclick="snoozeReminder(1)"
                                        class="flex-1 bg-gray-200 text-gray-700 py-3 px-3 rounded-lg text-sm hover:bg-gray-300 transition-colors mobile-touch-target">
                                        <i class="fas fa-clock mr-1"></i>Snooze
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleReminderMenu(1)"
                                            class="w-full sm:w-auto bg-gray-100 text-gray-600 py-3 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors mobile-touch-target">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <div id="reminderMenu1"
                                            class="hidden absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg border z-10">
                                            <button onclick="editReminder(1)"
                                                class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 mobile-touch-target">
                                                <i class="fas fa-edit mr-2"></i>Edit
                                            </button>
                                            <button onclick="duplicateReminder(1)"
                                                class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 mobile-touch-target">
                                                <i class="fas fa-copy mr-2"></i>Duplicate
                                            </button>
                                            <button onclick="deleteReminder(1)"
                                                class="w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 mobile-touch-target">
                                                <i class="fas fa-trash mr-2"></i>Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm border hover:shadow-md transition-shadow duration-200 overflow-hidden"
                            data-type="medicine" data-status="upcoming" data-priority="medium">
                            <div class="p-6">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                            <span class="text-lg">üíä</span>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-900">Medication Refill</h3>
                                            <div class="flex items-center space-x-2 mt-1">
                                                <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>
                                                <span class="text-xs text-yellow-600 font-medium">Medium Priority</span>
                                            </div>
                                        </div>
                                    </div>
                                    <span
                                        class="px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded-full font-medium">3
                                        days</span>
                                </div>

                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-calendar mr-2 w-4"></i>
                                        <span>June 28, 2024</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-map-marker-alt mr-2 w-4"></i>
                                        <span>CVS Pharmacy</span>
                                    </div>
                                    <p class="text-sm text-gray-700 mt-2">Refill blood pressure medication - Lisinopril
                                        10mg</p>
                                </div>

                                <div class="mb-4">
                                    <div class="text-xs font-medium text-gray-700 mb-2">Subtasks:</div>
                                    <div class="space-y-1">
                                        <div class="flex items-center text-xs text-gray-600">
                                            <input type="checkbox" class="mr-2 rounded">
                                            <span>Call pharmacy</span>
                                        </div>
                                        <div class="flex items-center text-xs text-gray-600">
                                            <input type="checkbox" class="mr-2 rounded">
                                            <span>Pick up medication</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex flex-col sm:flex-row gap-2">
                                    <button onclick="markReminderDone(2)"
                                        class="flex-1 bg-green-600 text-white py-3 px-3 rounded-lg text-sm hover:bg-green-700 transition-colors mobile-touch-target">
                                        <i class="fas fa-check mr-1"></i>Done
                                    </button>
                                    <button onclick="snoozeReminder(2)"
                                        class="flex-1 bg-gray-200 text-gray-700 py-3 px-3 rounded-lg text-sm hover:bg-gray-300 transition-colors mobile-touch-target">
                                        <i class="fas fa-clock mr-1"></i>Snooze
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleReminderMenu(2)"
                                            class="w-full sm:w-auto bg-gray-100 text-gray-600 py-3 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors mobile-touch-target">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <div id="reminderMenu2"
                                            class="hidden absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg border z-10">
                                            <button onclick="editReminder(2)"
                                                class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 mobile-touch-target">
                                                <i class="fas fa-edit mr-2"></i>Edit
                                            </button>
                                            <button onclick="duplicateReminder(2)"
                                                class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 mobile-touch-target">
                                                <i class="fas fa-copy mr-2"></i>Duplicate
                                            </button>
                                            <button onclick="deleteReminder(2)"
                                                class="w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 mobile-touch-target">
                                                <i class="fas fa-trash mr-2"></i>Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm border hover:shadow-md transition-shadow duration-200 overflow-hidden"
                            data-type="appointment" data-status="upcoming" data-priority="low">
                            <div class="p-6">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                            <span class="text-lg">üè•</span>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-900">Annual Checkup</h3>
                                            <div class="flex items-center space-x-2 mt-1">
                                                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                                <span class="text-xs text-green-600 font-medium">Low Priority</span>
                                            </div>
                                        </div>
                                    </div>
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full font-medium">2
                                        weeks</span>
                                </div>

                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-calendar mr-2 w-4"></i>
                                        <span>July 10, 2024 at 10:00 AM</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-map-marker-alt mr-2 w-4"></i>
                                        <span>Dr. Smith's Office</span>
                                    </div>
                                    <p class="text-sm text-gray-700 mt-2">Yearly comprehensive health examination</p>
                                </div>

                                <div class="mb-4">
                                    <div class="text-xs font-medium text-gray-700 mb-2">Subtasks:</div>
                                    <div class="space-y-1">
                                        <div class="flex items-center text-xs text-gray-600">
                                            <input type="checkbox" class="mr-2 rounded">
                                            <span>Fast 12 hours before</span>
                                        </div>
                                        <div class="flex items-center text-xs text-gray-600">
                                            <input type="checkbox" class="mr-2 rounded">
                                            <span>Bring insurance card</span>
                                        </div>
                                        <div class="flex items-center text-xs text-gray-600">
                                            <input type="checkbox" class="mr-2 rounded">
                                            <span>List current medications</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex flex-col sm:flex-row gap-2">
                                    <button onclick="markReminderDone(3)"
                                        class="flex-1 bg-green-600 text-white py-3 px-3 rounded-lg text-sm hover:bg-green-700 transition-colors mobile-touch-target">
                                        <i class="fas fa-check mr-1"></i>Done
                                    </button>
                                    <button onclick="snoozeReminder(3)"
                                        class="flex-1 bg-gray-200 text-gray-700 py-3 px-3 rounded-lg text-sm hover:bg-gray-300 transition-colors mobile-touch-target">
                                        <i class="fas fa-clock mr-1"></i>Snooze
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleReminderMenu(3)"
                                            class="w-full sm:w-auto bg-gray-100 text-gray-600 py-3 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors mobile-touch-target">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <div id="reminderMenu3"
                                            class="hidden absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg border z-10">
                                            <button onclick="editReminder(3)"
                                                class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 mobile-touch-target">
                                                <i class="fas fa-edit mr-2"></i>Edit
                                            </button>
                                            <button onclick="duplicateReminder(3)"
                                                class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 mobile-touch-target">
                                                <i class="fas fa-copy mr-2"></i>Duplicate
                                            </button>
                                            <button onclick="deleteReminder(3)"
                                                class="w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 mobile-touch-target">
                                                <i class="fas fa-trash mr-2"></i>Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Completed Reminder -->
                        <div class="bg-white rounded-xl shadow-sm border hover:shadow-md transition-shadow duration-200 overflow-hidden opacity-60"
                            data-type="lifestyle" data-status="completed" data-priority="low">
                            <div class="p-6">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                            <span class="text-lg">üßò</span>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-900">Morning Exercise</h3>
                                            <div class="flex items-center space-x-2 mt-1">
                                                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                                <span class="text-xs text-green-600 font-medium">Completed</span>
                                            </div>
                                        </div>
                                    </div>
                                    <span
                                        class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full font-medium">Done</span>
                                </div>

                                <div class="space-y-2 mb-4">
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-clock mr-2 w-4"></i>
                                        <span>7:00 AM</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-repeat mr-2 w-4"></i>
                                        <span>Daily</span>
                                    </div>
                                    <p class="text-sm text-gray-700 mt-2">30 minutes morning walk in the park</p>
                                </div>

                                <div class="flex flex-col sm:flex-row gap-2">
                                    <button
                                        class="flex-1 bg-gray-300 text-gray-600 py-3 px-3 rounded-lg text-sm cursor-not-allowed mobile-touch-target">
                                        <i class="fas fa-check mr-1"></i>Completed
                                    </button>
                                    <div class="relative">
                                        <button onclick="toggleReminderMenu(4)"
                                            class="w-full sm:w-auto bg-gray-100 text-gray-600 py-3 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors mobile-touch-target">
                                            <i class="fas fa-ellipsis-v"></i>
                                        </button>
                                        <div id="reminderMenu4"
                                            class="hidden absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg border z-10">
                                            <button onclick="undoCompletion(4)"
                                                class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 mobile-touch-target">
                                                <i class="fas fa-undo mr-2"></i>Undo
                                            </button>
                                            <button onclick="deleteReminder(4)"
                                                class="w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 mobile-touch-target">
                                                <i class="fas fa-trash mr-2"></i>Delete
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- List View (Hidden by default) -->
                    <div id="listView" class="hidden space-y-4">
                        <!-- List items will be populated here when toggled -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Add Reminder Modal -->
        <div id="reminderModal"
            class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full modal-scroll modal-mobile">
                <!-- Modal Header -->
                <div
                    class="flex items-center justify-between p-6 border-b border-gray-200 sticky top-0 bg-white rounded-t-xl z-10">
                    <div class="flex items-center space-x-3">
                        <h3 class="text-lg font-semibold text-gray-900">Add New Reminder</h3>
                        <div class="flex items-center space-x-2">
                            <button onclick="useTemplate('monthly-checkup')"
                                class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full hover:bg-blue-200">
                                üìã Templates
                            </button>
                        </div>
                    </div>
                    <button onclick="closeReminderModal()" class="text-gray-400 hover:text-gray-600 p-1">
                        <i class="fas fa-times text-lg"></i>
                    </button>
                </div>

                <!-- Template Dropdown -->
                <div id="templateDropdown" class="hidden bg-blue-50 border-b border-blue-200 p-4">
                    <h4 class="text-sm font-medium text-blue-900 mb-3">Quick Templates</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="applyTemplate('monthly-checkup')"
                            class="text-left p-3 bg-white rounded-lg hover:bg-blue-100 transition-colors">
                            <div class="font-medium text-sm text-gray-900">üè• Monthly Checkup</div>
                            <div class="text-xs text-gray-600">Doctor visit + blood work</div>
                        </button>
                        <button onclick="applyTemplate('daily-medicine')"
                            class="text-left p-3 bg-white rounded-lg hover:bg-blue-100 transition-colors">
                            <div class="font-medium text-sm text-gray-900">üíä Daily Medicine</div>
                            <div class="text-xs text-gray-600">Morning medication routine</div>
                        </button>
                        <button onclick="applyTemplate('weekly-exercise')"
                            class="text-left p-3 bg-white rounded-lg hover:bg-blue-100 transition-colors">
                            <div class="font-medium text-sm text-gray-900">üßò Weekly Exercise</div>
                            <div class="text-xs text-gray-600">Fitness routine reminder</div>
                        </button>
                        <button onclick="applyTemplate('lab-test')"
                            class="text-left p-3 bg-white rounded-lg hover:bg-blue-100 transition-colors">
                            <div class="font-medium text-sm text-gray-900">üß™ Lab Test</div>
                            <div class="text-xs text-gray-600">Blood work + prep tasks</div>
                        </button>
                    </div>
                </div>

                <!-- Modal Body -->
                <form id="reminderForm" class="p-6 space-y-6">
                    <!-- Basic Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Reminder Title -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Reminder Title</label>
                            <input type="text" id="reminderTitle" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="Enter reminder title">
                        </div>

                        <!-- Reminder Type -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                            <select id="reminderType" required onchange="updateTypeIcon()"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Select type</option>
                                <option value="test">üß™ Health Test</option>
                                <option value="medicine">üíä Medicine</option>
                                <option value="lifestyle">üßò Lifestyle</option>
                                <option value="appointment">üè• Appointment</option>
                            </select>
                        </div>

                        <!-- Priority -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                            <div class="flex flex-col sm:flex-row gap-2">
                                <label
                                    class="flex-1 flex items-center justify-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50 mobile-touch-target">
                                    <input type="radio" name="priority" value="low" checked class="sr-only">
                                    <span class="text-sm text-gray-700">üü¢ Low</span>
                                </label>
                                <label
                                    class="flex-1 flex items-center justify-center p-3 border rounded-lg cursor-pointer hover:bg-yellow-50 mobile-touch-target">
                                    <input type="radio" name="priority" value="medium" class="sr-only">
                                    <span class="text-sm text-yellow-700">üü° Medium</span>
                                </label>
                                <label
                                    class="flex-1 flex items-center justify-center p-3 border rounded-lg cursor-pointer hover:bg-red-50 mobile-touch-target">
                                    <input type="radio" name="priority" value="high" class="sr-only">
                                    <span class="text-sm text-red-700">üî¥ High</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Date & Time -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                            <input type="date" id="reminderDate" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Time</label>
                            <input type="time" id="reminderTime" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>

                    <!-- Recurrence & Advanced Options -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div>
                                <h4 class="font-medium text-gray-900">Recurring Reminder</h4>
                                <p class="text-sm text-gray-600">Set up automatic repeat</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="recurrenceToggle" class="sr-only peer"
                                    onchange="toggleRecurrence()">
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                </div>
                            </label>
                        </div>

                        <div id="recurrenceOptions" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Frequency</label>
                                <select id="reminderFrequency"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">End Date (Optional)</label>
                                <input type="date" id="recurrenceEndDate"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Two-Step Alerts -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-yellow-50 rounded-lg">
                            <div>
                                <h4 class="font-medium text-gray-900">Two-Step Alerts</h4>
                                <p class="text-sm text-gray-600">Get notified before the due date</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="twoStepToggle" class="sr-only peer"
                                    onchange="toggleTwoStep()">
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-yellow-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-500">
                                </div>
                            </label>
                        </div>

                        <div id="twoStepOptions" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Alert</label>
                                <select id="firstAlert"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="72">72 hours before</option>
                                    <option value="48">48 hours before</option>
                                    <option value="24">24 hours before</option>
                                    <option value="12">12 hours before</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Second Alert</label>
                                <select id="secondAlert"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="24">24 hours before</option>
                                    <option value="12">12 hours before</option>
                                    <option value="6">6 hours before</option>
                                    <option value="1">1 hour before</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Location-Based Reminder -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                            <div>
                                <h4 class="font-medium text-gray-900">Location-Based Reminder</h4>
                                <p class="text-sm text-gray-600">Trigger when arriving/leaving a location</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="locationToggle" class="sr-only peer"
                                    onchange="toggleLocation()">
                                <div
                                    class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600">
                                </div>
                            </label>
                        </div>

                        <div id="locationOptions" class="hidden space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                                <input type="text" id="reminderLocation"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="Enter address or location name">
                            </div>

                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="locationTrigger" value="arrive" checked
                                        class="text-green-600 focus:ring-green-500">
                                    <span class="ml-2 text-sm text-gray-700">On arrival</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="locationTrigger" value="leave"
                                        class="text-green-600 focus:ring-green-500">
                                    <span class="ml-2 text-sm text-gray-700">On departure</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Subtasks -->
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <h4 class="font-medium text-gray-900">Subtasks (Optional)</h4>
                            <button type="button" onclick="addSubtask()"
                                class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                                <i class="fas fa-plus mr-1"></i>Add Subtask
                            </button>
                        </div>

                        <div id="subtasksList" class="space-y-2">
                            <!-- Subtasks will be added here dynamically -->
                        </div>
                    </div>

                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description (Optional)</label>
                        <textarea id="reminderDescription" rows="3"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                            placeholder="Add any additional notes..."></textarea>
                    </div>
                </form>

                <!-- Modal Footer -->
                <div
                    class="flex flex-col sm:flex-row items-center justify-end gap-3 p-6 border-t border-gray-200 bg-gray-50 rounded-b-xl sticky bottom-0">
                    <button onclick="closeReminderModal()"
                        class="w-full sm:w-auto px-4 py-3 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors mobile-touch-target">
                        Cancel
                    </button>
                    <button onclick="saveReminder()"
                        class="w-full sm:w-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mobile-touch-target">
                        <i class="fas fa-save mr-2"></i>Save Reminder
                    </button>
                </div>
            </div>
        </div>

        <script>
            // File upload functionality
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const filePreview = document.getElementById('filePreview');
            const fileList = document.getElementById('fileList');
            let selectedFiles = [];

            // Drag and drop events
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });

            fileInput.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                handleFiles(files);
            });

            function handleFiles(files) {
                selectedFiles = files;
                displayFiles();
                filePreview.classList.remove('hidden');
            }

            function displayFiles() {
                fileList.innerHTML = '';
                selectedFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'flex items-center justify-between bg-gray-50 p-3 rounded-lg';
                    fileItem.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-file-${getFileIcon(file.type)} text-blue-600"></i>
                        <div>
                            <p class="text-sm font-medium text-gray-900">${file.name}</p>
                            <p class="text-xs text-gray-500">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                        </div>
                    </div>
                    <button onclick="removeFile(${index})" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                    fileList.appendChild(fileItem);
                });
            }

            function getFileIcon(fileType) {
                if (fileType.includes('pdf')) return 'pdf';
                if (fileType.includes('image')) return 'image';
                return 'alt';
            }

            function removeFile(index) {
                selectedFiles.splice(index, 1);
                if (selectedFiles.length === 0) {
                    filePreview.classList.add('hidden');
                } else {
                    displayFiles();
                }
            }

            async function uploadFiles() {
                if (selectedFiles.length === 0) return;

                const uploadButton = event.target;
                uploadButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
                uploadButton.disabled = true;

                // Show progress
                document.getElementById('analysisProgress').classList.remove('hidden');

                try {
                    for (let i = 0; i < selectedFiles.length; i++) {
                        const file = selectedFiles[i];
                        updateAnalysisProgress(20, `Processing ${file.name}...`);

                        let extractedText = '';

                        if (file.type === 'application/pdf') {
                            extractedText = await extractTextFromPDF(file);
                        } else if (file.type.startsWith('image/')) {
                            extractedText = await extractTextFromImage(file);
                        } else {
                            extractedText = await file.text();
                        }

                        updateAnalysisProgress(60, 'Analyzing medical data...');

                        // Simulate AI analysis (in real app, this would call OpenAI/LangChain)
                        const analysisResult = await analyzeMedicalReport(extractedText, file.name);

                        updateAnalysisProgress(90, 'Generating insights...');

                        // Display results
                        displayAnalysisResults(analysisResult);

                        updateAnalysisProgress(100, 'Analysis complete!');
                    }

                    setTimeout(() => {
                        document.getElementById('analysisProgress').classList.add('hidden');
                        uploadButton.innerHTML = '<i class="fas fa-check mr-2"></i>Analysis Complete!';
                        uploadButton.className = 'mt-4 bg-green-600 text-white px-6 py-2 rounded-lg';

                        setTimeout(() => {
                            resetUploadForm();
                        }, 3000);
                    }, 1000);

                } catch (error) {
                    console.error('Analysis failed:', error);
                    updateAnalysisProgress(0, 'Analysis failed. Please try again.');
                    uploadButton.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>Try Again';
                    uploadButton.disabled = false;
                    uploadButton.className = 'mt-4 bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors';
                }
            }

            function resetUploadForm() {
                document.getElementById('filePreview').classList.add('hidden');
                document.getElementById('analysisProgress').classList.add('hidden');
                selectedFiles = [];
                fileInput.value = '';
                const uploadButton = document.querySelector('button[onclick="uploadFiles()"]');
                uploadButton.innerHTML = '<i class="fas fa-check mr-2"></i>Upload & Analyze Reports';
                uploadButton.disabled = false;
                uploadButton.className = 'mt-4 bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors';
            }

            function updateAnalysisProgress(percentage, status) {
                document.getElementById('analysisProgressBar').style.width = percentage + '%';
                document.getElementById('analysisStatus').textContent = status;
            }

            async function extractTextFromPDF(file) {
                return new Promise((resolve, reject) => {
                    const fileReader = new FileReader();
                    fileReader.onload = async function () {
                        try {
                            const typedarray = new Uint8Array(this.result);
                            const pdf = await pdfjsLib.getDocument(typedarray).promise;
                            let fullText = '';

                            for (let i = 1; i <= pdf.numPages; i++) {
                                const page = await pdf.getPage(i);
                                const textContent = await page.getTextContent();
                                const pageText = textContent.items.map(item => item.str).join(' ');
                                fullText += pageText + '\n';
                            }

                            resolve(fullText);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    fileReader.readAsArrayBuffer(file);
                });
            }

            function splitIntoChunks(text, maxWords = 300) {
                const words = text.split(/\s+/);
                const chunks = [];

                for (let i = 0; i < words.length; i += maxWords) {
                    chunks.push(words.slice(i, i + maxWords).join(' '));
                }

                return chunks;
            }

            const getPromptMessages = (chunk, fileName) => [
                {
                    role: "system",
                    content: `You are a medical report analyzer. Extract key lab values and return a clean JSON object. Avoid repeating instructions. Keep it short, and do not make up data.`
                },
                {
                    role: "user",
                    content: `Analyze this medical report section and return JSON with results only:

            --- START ---

            ${chunk}

            --- END ---

            Only return array of "results" with structure:
            [
              {
                "test": "...",
                "value": "...",
                "unit": "...",
                "normal_range": "...",
                "status": "...",
                "explanation": "...",
                "urgency": "..."
              }
            ]`
                }
            ];


            async function extractTextFromImage(file) {
                return new Promise((resolve, reject) => {
                    Tesseract.recognize(file, 'eng', {
                        logger: m => {
                            if (m.status === 'recognizing text') {
                                const progress = Math.round(m.progress * 40) + 20; // 20-60% of total progress
                                updateAnalysisProgress(progress, 'Reading text from image...');
                            }
                        }
                    }).then(({data: {text}}) => {
                        resolve(text);
                    }).catch(reject);
                });
            }

            async function analyzeMedicalReport(extractedText, fileName) {
                const chunks = splitIntoChunks(extractedText, 300); // split large report
                let allResults = [];

                // 1Ô∏è‚É£ Analyze each chunk using your backend API
                for (const chunk of chunks) {
                    try {
                        const res = await fetch('/api/analyze', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({chunk, fileName})
                        });

                        if (!res.ok) {
                            const errText = await res.text();
                            console.warn("‚ùå Failed to analyze chunk:", errText);
                            continue;
                        }

                        const parsed = await res.json();

                        if (Array.isArray(parsed)) {
                            allResults.push(...parsed);
                        } else {
                            console.warn("Unexpected response format from /api/analyze:", parsed);
                        }
                    } catch (err) {
                        console.error("Error analyzing chunk:", err);
                    }
                }

                // 2Ô∏è‚É£ Request summary from your backend
                let recommendations = [], urgent_flags = [], overall_status = "Normal";

                try {
                    const summaryRes = await fetch('/api/summarize', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({allResults})
                    });

                    if (!summaryRes.ok) {
                        const errorText = await summaryRes.text();
                        console.warn("‚ùå Summary API failed:", errorText);
                    } else {
                        const summary = await summaryRes.json();
                        recommendations = summary.recommendations || [];
                        urgent_flags = summary.urgent_flags || [];
                        overall_status = summary.overall_status || "Review Needed";
                    }
                } catch (err) {
                    console.error("Error getting summary:", err);
                }

                // ‚úÖ Final response object
                return {
                    report_type: "Auto-analyzed Report",
                    file_name: fileName,
                    date_analyzed: new Date().toISOString().split('T')[0],
                    overall_status,
                    results: allResults,
                    recommendations,
                    urgent_flags
                };
            }

            function generateEnhancedAnalysis(text, fileName) {
                // Enhanced pattern matching with better medical term recognition
                const lowerText = text.toLowerCase();
                const analysisDate = new Date().toLocaleDateString();

                // Detect language (basic implementation)
                const languageDetected = detectLanguage(text);

                // Enhanced cholesterol/lipid analysis
                if (lowerText.includes('cholesterol') || lowerText.includes('lipid') || lowerText.includes('hdl') || lowerText.includes('ldl')) {
                    return {
                        report_type: "Lipid Profile",
                        date_analyzed: analysisDate,
                        file_name: fileName,
                        summary: "This lipid profile shows some values that need attention. Your LDL cholesterol is elevated, which increases cardiovascular risk.",
                        overall_status: "Needs Attention",
                        confidence_score: 0.92,
                        language_detected: languageDetected,
                        results: [
                            {
                                test: "Total Cholesterol",
                                value: "245",
                                unit: "mg/dL",
                                normal_range: "< 200 mg/dL",
                                status: "High",
                                severity: "moderate",
                                explanation: "Total cholesterol is above the desirable level. This increases your risk of heart disease and stroke.",
                                trend: "stable",
                                urgency: "monitor"
                            },
                            {
                                test: "LDL Cholesterol",
                                value: "170",
                                unit: "mg/dL",
                                normal_range: "< 130 mg/dL",
                                status: "High",
                                severity: "moderate",
                                explanation: "LDL (bad) cholesterol is elevated. This can lead to plaque buildup in your arteries.",
                                trend: "stable",
                                urgency: "monitor"
                            },
                            {
                                test: "HDL Cholesterol",
                                value: "45",
                                unit: "mg/dL",
                                normal_range: "> 40 mg/dL (men), > 50 mg/dL (women)",
                                status: "Borderline",
                                severity: "low",
                                explanation: "HDL (good) cholesterol is at the lower end of normal. Higher levels help protect against heart disease.",
                                trend: "stable",
                                urgency: "routine"
                            },
                            {
                                test: "Triglycerides",
                                value: "180",
                                unit: "mg/dL",
                                normal_range: "< 150 mg/dL",
                                status: "High",
                                severity: "moderate",
                                explanation: "Triglycerides are elevated, which can increase heart disease risk, especially when combined with high LDL.",
                                trend: "stable",
                                urgency: "monitor"
                            }
                        ],
                        recommendations: [
                            "Adopt a heart-healthy diet low in saturated and trans fats",
                            "Increase physical activity to at least 150 minutes per week",
                            "Consider omega-3 rich foods like fish, walnuts, and flaxseeds",
                            "Limit refined carbohydrates and added sugars",
                            "Schedule follow-up with your doctor to discuss treatment options",
                            "Retest lipid levels in 6-8 weeks after lifestyle changes"
                        ],
                        urgent_flags: [
                            "LDL cholesterol significantly elevated - discuss statin therapy with doctor"
                        ],
                        follow_up_timeline: "6-8 weeks for retest after lifestyle modifications",
                        specialist_referral: "Consider cardiology consultation if levels remain elevated"
                    };
                } else if (lowerText.includes('glucose') || lowerText.includes('sugar') || lowerText.includes('hba1c') || lowerText.includes('diabetes')) {
                    return {
                        report_type: "Blood Sugar Analysis",
                        date_analyzed: analysisDate,
                        file_name: fileName,
                        summary: "Your blood sugar levels indicate prediabetes. Early intervention can prevent progression to type 2 diabetes.",
                        overall_status: "Prediabetic Range",
                        confidence_score: 0.89,
                        language_detected: languageDetected,
                        results: [
                            {
                                test: "Fasting Glucose",
                                value: "115",
                                unit: "mg/dL",
                                normal_range: "70-99 mg/dL",
                                status: "High",
                                severity: "moderate",
                                explanation: "Fasting glucose is in the prediabetic range (100-125 mg/dL). This indicates your body is having trouble processing sugar.",
                                trend: "worsening",
                                urgency: "monitor"
                            },
                            {
                                test: "HbA1c",
                                value: "6.2",
                                unit: "%",
                                normal_range: "< 5.7%",
                                status: "High",
                                severity: "moderate",
                                explanation: "HbA1c shows your average blood sugar over 2-3 months. 5.7-6.4% indicates prediabetes.",
                                trend: "stable",
                                urgency: "monitor"
                            },
                            {
                                test: "Random Glucose",
                                value: "145",
                                unit: "mg/dL",
                                normal_range: "< 140 mg/dL",
                                status: "Borderline",
                                severity: "low",
                                explanation: "Random glucose is slightly elevated but not in diabetic range yet.",
                                trend: "stable",
                                urgency: "routine"
                            }
                        ],
                        recommendations: [
                            "Reduce refined carbohydrates and sugary foods",
                            "Increase fiber intake with whole grains, vegetables, and fruits",
                            "Engage in regular physical activity, especially after meals",
                            "Maintain a healthy weight through portion control",
                            "Monitor blood sugar levels as recommended by your doctor",
                            "Consider meeting with a nutritionist for meal planning",
                            "Check feet daily for cuts or sores",
                            "Schedule regular eye exams"
                        ],
                        urgent_flags: [
                            "Prediabetes detected - lifestyle changes needed to prevent diabetes",
                            "Consider diabetes prevention program enrollment"
                        ],
                        follow_up_timeline: "3 months for HbA1c recheck",
                        specialist_referral: "Endocrinologist consultation recommended if levels worsen"
                    };
                } else if (lowerText.includes('thyroid') || lowerText.includes('tsh') || lowerText.includes('t3') || lowerText.includes('t4')) {
                    return {
                        report_type: "Thyroid Function Panel",
                        date_analyzed: analysisDate,
                        file_name: fileName,
                        summary: "Your thyroid function shows mild hypothyroidism. This can affect metabolism and energy levels.",
                        overall_status: "Needs Attention",
                        confidence_score: 0.87,
                        language_detected: languageDetected,
                        results: [
                            {
                                test: "TSH",
                                value: "8.5",
                                unit: "mIU/L",
                                normal_range: "0.4-4.0 mIU/L",
                                status: "High",
                                severity: "moderate",
                                explanation: "TSH is elevated, indicating your thyroid gland is underactive (hypothyroidism).",
                                trend: "worsening",
                                urgency: "monitor"
                            },
                            {
                                test: "Free T4",
                                value: "0.8",
                                unit: "ng/dL",
                                normal_range: "0.9-1.7 ng/dL",
                                status: "Low",
                                severity: "moderate",
                                explanation: "Free T4 is below normal, confirming hypothyroidism. This hormone regulates metabolism.",
                                trend: "stable",
                                urgency: "monitor"
                            }
                        ],
                        recommendations: [
                            "Consult with an endocrinologist for thyroid hormone replacement therapy",
                            "Include iodine-rich foods like seaweed and fish in your diet",
                            "Avoid excessive soy products which can interfere with thyroid function",
                            "Take thyroid medication on empty stomach if prescribed",
                            "Monitor symptoms like fatigue, weight gain, and cold intolerance"
                        ],
                        urgent_flags: [
                            "Hypothyroidism detected - medical treatment likely needed"
                        ],
                        follow_up_timeline: "6-8 weeks after starting treatment",
                        specialist_referral: "Endocrinologist consultation recommended"
                    };
                } else if (lowerText.includes('cbc') || lowerText.includes('hemoglobin') || lowerText.includes('hematocrit') || lowerText.includes('wbc')) {
                    return {
                        report_type: "Complete Blood Count (CBC)",
                        date_analyzed: analysisDate,
                        file_name: fileName,
                        summary: "Your blood count shows mild anemia. This may cause fatigue and requires further evaluation.",
                        overall_status: "Needs Attention",
                        confidence_score: 0.91,
                        language_detected: languageDetected,
                        results: [
                            {
                                test: "Hemoglobin",
                                value: "10.5",
                                unit: "g/dL",
                                normal_range: "12.0-15.5 g/dL (women), 13.5-17.5 g/dL (men)",
                                status: "Low",
                                severity: "moderate",
                                explanation: "Hemoglobin is below normal, indicating anemia. This reduces oxygen-carrying capacity.",
                                trend: "stable",
                                urgency: "monitor"
                            },
                            {
                                test: "White Blood Cells",
                                value: "7.2",
                                unit: "K/ŒºL",
                                normal_range: "4.5-11.0 K/ŒºL",
                                status: "Normal",
                                severity: "low",
                                explanation: "White blood cell count is normal, indicating no signs of infection or immune issues.",
                                trend: "stable",
                                urgency: "routine"
                            },
                            {
                                test: "Platelets",
                                value: "250",
                                unit: "K/ŒºL",
                                normal_range: "150-450 K/ŒºL",
                                status: "Normal",
                                severity: "low",
                                explanation: "Platelet count is normal, indicating proper blood clotting function.",
                                trend: "stable",
                                urgency: "routine"
                            }
                        ],
                        recommendations: [
                            "Increase iron-rich foods like lean meats, spinach, and beans",
                            "Take vitamin C with iron-rich meals to enhance absorption",
                            "Avoid tea and coffee with meals as they can reduce iron absorption",
                            "Consider iron supplementation if recommended by your doctor",
                            "Get adequate sleep and manage stress levels"
                        ],
                        urgent_flags: [
                            "Anemia detected - investigate underlying cause"
                        ],
                        follow_up_timeline: "4-6 weeks to reassess hemoglobin levels",
                        specialist_referral: "Hematologist if anemia persists or worsens"
                    };
                } else {
                    return {
                        report_type: "General Health Report",
                        date_analyzed: analysisDate,
                        file_name: fileName,
                        summary: "Your health report has been analyzed. Most values appear to be within normal ranges.",
                        overall_status: "Generally Normal",
                        confidence_score: 0.75,
                        language_detected: languageDetected,
                        results: [
                            {
                                test: "Overall Assessment",
                                value: "Multiple parameters reviewed",
                                unit: "Various",
                                normal_range: "Varies by test",
                                status: "Normal",
                                severity: "low",
                                explanation: "The analyzed report shows most health markers are within expected ranges.",
                                trend: "stable",
                                urgency: "routine"
                            }
                        ],
                        recommendations: [
                            "Continue maintaining healthy lifestyle habits",
                            "Regular exercise and balanced nutrition",
                            "Stay hydrated and get adequate sleep",
                            "Schedule regular check-ups with your healthcare provider",
                            "Keep track of any symptoms or changes in health"
                        ],
                        urgent_flags: [],
                        follow_up_timeline: "Annual routine check-up",
                        specialist_referral: null
                    };
                }
            }

            // Language detection helper function
            function detectLanguage(text) {
                const commonEnglishWords = ['the', 'and', 'test', 'result', 'normal', 'high', 'low', 'patient'];
                const commonSpanishWords = ['el', 'la', 'y', 'resultado', 'normal', 'alto', 'bajo', 'paciente'];
                const commonFrenchWords = ['le', 'la', 'et', 'r√©sultat', 'normal', 'haut', 'bas', 'patient'];

                const lowerText = text.toLowerCase();
                let englishScore = 0;
                let spanishScore = 0;
                let frenchScore = 0;

                commonEnglishWords.forEach(word => {
                    if (lowerText.includes(word)) englishScore++;
                });

                commonSpanishWords.forEach(word => {
                    if (lowerText.includes(word)) spanishScore++;
                });

                commonFrenchWords.forEach(word => {
                    if (lowerText.includes(word)) frenchScore++;
                });

                if (spanishScore > englishScore && spanishScore > frenchScore) return 'es';
                if (frenchScore > englishScore && frenchScore > spanishScore) return 'fr';
                return 'en'; // Default to English
            }

            function displayAnalysisResults(analysis) {
                const resultsContainer = document.getElementById('analysisResults');
                const contentContainer = document.getElementById('analysisContent');

                // Store analysis for download
                window.currentAnalysis = analysis;

                const statusColor = {
                    'Normal': 'text-green-600 bg-green-100',
                    'Generally Normal': 'text-green-600 bg-green-100',
                    'Needs Attention': 'text-yellow-600 bg-yellow-100',
                    'Prediabetic Range': 'text-orange-600 bg-orange-100',
                    'Critical': 'text-red-600 bg-red-100'
                };

                const severityColor = {
                    'low': 'border-green-200 bg-green-50',
                    'moderate': 'border-yellow-200 bg-yellow-50',
                    'high': 'border-red-200 bg-red-50'
                };

                contentContainer.innerHTML = `
                <!-- Report Header -->
                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <h5 class="text-lg font-semibold text-gray-900">${analysis.report_type}</h5>
                        <span class="px-3 py-1 rounded-full text-sm font-medium ${statusColor[analysis.overall_status] || 'text-gray-600 bg-gray-100'}">${analysis.overall_status}</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3 text-sm text-gray-600">
                        <div><i class="fas fa-file mr-2"></i>File: ${analysis.file_name}</div>
                        <div><i class="fas fa-calendar mr-2"></i>Analyzed: ${analysis.date_analyzed}</div>
                        <div><i class="fas fa-chart-line mr-2"></i>Confidence: ${Math.round((analysis.confidence_score || 0.85) * 100)}%</div>
                    </div>
                    ${analysis.language_detected && analysis.language_detected !== 'en' ? `
                    <div class="mb-3 p-2 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800">
                        <i class="fas fa-language mr-2"></i>Language detected: ${analysis.language_detected.toUpperCase()}
                    </div>
                    ` : ''}
                    <p class="text-gray-700">${analysis.summary}</p>
                </div>
                
                <!-- Urgent Flags -->
                ${analysis.urgent_flags && analysis.urgent_flags.length > 0 ? `
                <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
                        <h6 class="font-semibold text-red-900">Urgent Attention Required</h6>
                    </div>
                    <ul class="space-y-1">
                        ${analysis.urgent_flags.map(flag => `<li class="text-sm text-red-800">‚Ä¢ ${flag}</li>`).join('')}
                    </ul>
                </div>
                ` : ''}
                
                <!-- Test Results -->
                <div class="mb-6">
                    <h6 class="font-semibold text-gray-900 mb-4">Test Results</h6>
                    <div class="space-y-4">
                        ${analysis.results.map(result => `
                            <div class="border rounded-lg p-4 ${severityColor[result.severity] || 'border-gray-200 bg-gray-50'}">
                                <div class="flex items-center justify-between mb-2">
                                    <h7 class="font-medium text-gray-900">${result.test}</h7>
                                    <div class="flex items-center space-x-2">
                                        ${result.urgency === 'critical' ? '<i class="fas fa-exclamation-triangle text-red-600"></i>' :
                        result.urgency === 'urgent' ? '<i class="fas fa-exclamation-circle text-orange-600"></i>' :
                            result.urgency === 'monitor' ? '<i class="fas fa-eye text-yellow-600"></i>' : ''}
                                        <span class="px-2 py-1 rounded text-xs font-medium ${result.status === 'Normal' ? 'bg-green-100 text-green-800' :
                        result.status === 'High' ? 'bg-red-100 text-red-800' :
                            result.status === 'Low' ? 'bg-blue-100 text-blue-800' :
                                result.status === 'Critical' ? 'bg-red-200 text-red-900' :
                                    'bg-yellow-100 text-yellow-800'
                    }">${result.status}</span>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                                    <div>
                                        <span class="text-sm text-gray-600">Your Value:</span>
                                        <span class="text-sm font-medium text-gray-900 ml-2">${result.value}${result.unit ? ' ' + result.unit : ''}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm text-gray-600">Normal Range:</span>
                                        <span class="text-sm font-medium text-gray-900 ml-2">${result.normal_range}</span>
                                    </div>
                                    <div>
                                        <span class="text-sm text-gray-600">Trend:</span>
                                        <span class="text-sm font-medium ml-2 ${result.trend === 'improving' ? 'text-green-600' :
                        result.trend === 'worsening' ? 'text-red-600' :
                            'text-gray-600'
                    }">
                                            ${result.trend === 'improving' ? '‚ÜóÔ∏è Improving' :
                        result.trend === 'worsening' ? '‚ÜòÔ∏è Worsening' :
                            '‚û°Ô∏è Stable'}
                                        </span>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-700">${result.explanation}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Recommendations -->
                <div class="mb-6">
                    <h6 class="font-semibold text-gray-900 mb-4">Recommendations</h6>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <ul class="space-y-2">
                            ${analysis.recommendations.map(rec => `
                                <li class="flex items-start space-x-2">
                                    <i class="fas fa-check-circle text-blue-600 mt-0.5 text-sm"></i>
                                    <span class="text-sm text-blue-900">${rec}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
                
                <!-- Follow-up Information -->
                ${analysis.follow_up_timeline || analysis.specialist_referral ? `
                <div class="mb-6">
                    <h6 class="font-semibold text-gray-900 mb-4">Follow-up Plan</h6>
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        ${analysis.follow_up_timeline ? `
                        <div class="flex items-center mb-2">
                            <i class="fas fa-calendar-check text-purple-600 mr-2"></i>
                            <span class="text-sm font-medium text-purple-900">Next Check-up:</span>
                            <span class="text-sm text-purple-800 ml-2">${analysis.follow_up_timeline}</span>
                        </div>
                        ` : ''}
                        ${analysis.specialist_referral ? `
                        <div class="flex items-center">
                            <i class="fas fa-user-md text-purple-600 mr-2"></i>
                            <span class="text-sm font-medium text-purple-900">Specialist Referral:</span>
                            <span class="text-sm text-purple-800 ml-2">${analysis.specialist_referral}</span>
                        </div>
                        ` : ''}
                    </div>
                </div>
                ` : ''}
                
                <!-- Disclaimer -->
                <div class="p-4 bg-gray-100 rounded-lg border-l-4 border-gray-400">
                    <div class="flex items-start space-x-2">
                        <i class="fas fa-info-circle text-gray-600 mt-0.5"></i>
                        <div>
                            <p class="text-sm font-medium text-gray-900">Medical Disclaimer</p>
                            <p class="text-xs text-gray-700 mt-1">This AI analysis is for informational purposes only and should not replace professional medical advice. Always consult with your healthcare provider for proper diagnosis and treatment. Critical values require immediate medical attention.</p>
                        </div>
                    </div>
                </div>
            `;

                resultsContainer.classList.remove('hidden');

                // Scroll to results
                resultsContainer.scrollIntoView({behavior: 'smooth', block: 'start'});
            }

            function downloadAnalysis() {
                if (!window.currentAnalysis) return;

                const analysis = window.currentAnalysis;
                const reportContent = `
HEALTH REPORT ANALYSIS
======================

Report Type: ${analysis.report_type}
File: ${analysis.file_name}
Date Analyzed: ${analysis.date_analyzed}
Overall Status: ${analysis.overall_status}

SUMMARY
-------
${analysis.summary}

${analysis.urgent_flags && analysis.urgent_flags.length > 0 ? `
URGENT ATTENTION REQUIRED
-------------------------
${analysis.urgent_flags.map(flag => `‚Ä¢ ${flag}`).join('\n')}
` : ''}

TEST RESULTS
------------
${analysis.results.map(result => `
${result.test}
  Value: ${result.value}
  Normal Range: ${result.normal_range}
  Status: ${result.status}
  Explanation: ${result.explanation}
`).join('\n')}

RECOMMENDATIONS
---------------
${analysis.recommendations.map(rec => `‚Ä¢ ${rec}`).join('\n')}

DISCLAIMER
----------
This analysis is for informational purposes only and should not replace professional medical advice. Always consult with your healthcare provider for proper diagnosis and treatment.

Generated by Health Dashboard - ${new Date().toLocaleString()}
            `.trim();

                const blob = new Blob([reportContent], {type: 'text/plain'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `health-analysis-${analysis.report_type.toLowerCase().replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // Health Chart
            const ctx = document.getElementById('healthChart').getContext('2d');
            let healthChart;

            const chartData = {
                cholesterol: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    data: [220, 210, 205, 195, 190, 185],
                    color: 'rgb(59, 130, 246)',
                    label: 'Cholesterol (mg/dL)'
                },
                bloodPressure: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    data: [130, 125, 122, 120, 118, 120],
                    color: 'rgb(16, 185, 129)',
                    label: 'Systolic BP (mmHg)'
                },
                bloodSugar: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    data: [105, 100, 98, 95, 92, 95],
                    color: 'rgb(245, 158, 11)',
                    label: 'Blood Sugar (mg/dL)'
                }
            };

            function initChart() {
                healthChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: chartData.cholesterol.labels,
                        datasets: [{
                            label: chartData.cholesterol.label,
                            data: chartData.cholesterol.data,
                            borderColor: chartData.cholesterol.color,
                            backgroundColor: chartData.cholesterol.color + '20',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: chartData.cholesterol.color,
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    color: '#f3f4f6'
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }

            function updateChart(type) {
                // Update button styles
                document.querySelectorAll('button[onclick^="updateChart"]').forEach(btn => {
                    btn.className = 'px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors';
                });
                event.target.className = 'px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors';

                // Update chart data
                const data = chartData[type];
                healthChart.data.datasets[0].label = data.label;
                healthChart.data.datasets[0].data = data.data;
                healthChart.data.datasets[0].borderColor = data.color;
                healthChart.data.datasets[0].backgroundColor = data.color + '20';
                healthChart.data.datasets[0].pointBackgroundColor = data.color;
                healthChart.update();
            }

            // Initialize chart when page loads
            window.addEventListener('load', initChart);

            // Chat functionality
            let chatHistory = [];

            const healthResponses = {
                'cholesterol': {
                    keywords: ['cholesterol', 'ldl', 'hdl', 'lipid'],
                    response: "Based on your current cholesterol level of 185 mg/dL, you're doing well! To maintain or improve it further, I recommend: 1) Eating more fiber-rich foods like oats and beans, 2) Including healthy fats from nuts and olive oil, 3) Regular exercise (30 min daily), and 4) Limiting saturated fats. Your recent 15% improvement shows you're on the right track! üéØ"
                },
                'exercise': {
                    keywords: ['exercise', 'workout', 'physical', 'activity', 'heart', 'cardio'],
                    response: "For your heart health, I recommend a mix of activities: 1) Brisk walking 30 minutes daily, 2) Swimming 2-3 times per week, 3) Light strength training twice weekly, and 4) Yoga for stress management. Start gradually and listen to your body. Your current health metrics show you can safely increase activity! üí™"
                },
                'blood pressure': {
                    keywords: ['blood pressure', 'bp', 'hypertension', 'systolic', 'diastolic'],
                    response: "Your blood pressure of 120/80 is excellent! To maintain this: 1) Check it weekly at the same time, 2) Limit sodium to under 2,300mg daily, 3) Stay hydrated, 4) Manage stress through relaxation techniques, and 5) Maintain regular sleep schedule. Keep up the great work! ü©∫"
                },
                'diet': {
                    keywords: ['diet', 'food', 'nutrition', 'eat', 'meal'],
                    response: "For optimal health based on your metrics, focus on: 1) Mediterranean-style diet with lots of vegetables, 2) Lean proteins like fish and chicken, 3) Whole grains instead of refined carbs, 4) Healthy snacks like nuts and fruits, and 5) Stay hydrated with 8 glasses of water daily. Small changes make big differences! ü•ó"
                },
                'sleep': {
                    keywords: ['sleep', 'rest', 'tired', 'insomnia'],
                    response: "Quality sleep is crucial for your health! Aim for 7-9 hours nightly. Tips: 1) Keep a consistent sleep schedule, 2) Create a relaxing bedtime routine, 3) Avoid screens 1 hour before bed, 4) Keep your room cool and dark, and 5) Limit caffeine after 2 PM. Good sleep helps regulate blood pressure and metabolism! üò¥"
                }
            };

            function sendMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();

                if (message) {
                    addUserMessage(message);
                    input.value = '';

                    // Simulate AI thinking
                    setTimeout(() => {
                        const response = generateResponse(message);
                        addAIMessage(response);
                    }, 1000);
                }
            }

            function askQuestion(question) {
                document.getElementById('chatInput').value = question;
                sendMessage();
            }

            function addUserMessage(message) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-start space-x-3 justify-end';
                messageDiv.innerHTML = `
                <div class="bg-blue-600 text-white rounded-2xl rounded-tr-sm p-4 shadow-sm max-w-xs">
                    <p class="text-sm">${message}</p>
                    <span class="text-xs text-blue-100 mt-2 block">Just now</span>
                </div>
                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-user text-gray-600 text-xs"></i>
                </div>
            `;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function addAIMessage(message) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex items-start space-x-3';
                messageDiv.innerHTML = `
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-teal-500 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-user-md text-white text-xs"></i>
                </div>
                <div class="bg-white rounded-2xl rounded-tl-sm p-4 shadow-sm max-w-md">
                    <p class="text-sm text-gray-800">${message}</p>
                    <span class="text-xs text-gray-500 mt-2 block">Just now</span>
                </div>
            `;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function generateResponse(message) {
                const lowerMessage = message.toLowerCase();

                // Check for specific health topics
                for (const [topic, data] of Object.entries(healthResponses)) {
                    if (data.keywords.some(keyword => lowerMessage.includes(keyword))) {
                        return data.response;
                    }
                }

                // Generic responses for common questions
                if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
                    return "Hello! I'm here to help with your health questions. I can provide advice based on your current health data. What would you like to know? üëã";
                }

                if (lowerMessage.includes('thank')) {
                    return "You're very welcome! I'm always here to help with your health journey. Remember, small consistent changes lead to big improvements! üòä";
                }

                if (lowerMessage.includes('weight') || lowerMessage.includes('bmi')) {
                    return "Your BMI of 22.4 is in the healthy range! To maintain this: 1) Continue balanced eating, 2) Stay active with regular exercise, 3) Monitor portion sizes, and 4) Focus on nutrient-dense foods. You're doing great! ‚öñÔ∏è";
                }

                // Default response
                return "That's a great question! Based on your current health metrics, I'd recommend consulting with your healthcare provider for personalized advice on this topic. In the meantime, maintaining your current healthy habits with regular exercise, balanced nutrition, and adequate sleep will benefit your overall wellness. Is there anything specific about your current health data you'd like me to explain? ü©∫";
            }

            function handleKeyPress(event) {
                if (event.key === 'Enter') {
                    sendMessage();
                }
            }

            function clearChat() {
                const chatMessages = document.getElementById('chatMessages');
                chatMessages.innerHTML = `
                <!-- Welcome Message -->
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-teal-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-user-md text-white text-xs"></i>
                    </div>
                    <div class="bg-white rounded-2xl rounded-tl-sm p-4 shadow-sm max-w-xs">
                        <p class="text-sm text-gray-800">Hello! I'm your AI health assistant. I can help answer questions about your health data, provide wellness tips, and offer personalized advice. What would you like to know?</p>
                        <span class="text-xs text-gray-500 mt-2 block">Just now</span>
                    </div>
                </div>
                
                <!-- Quick Suggestion Buttons -->
                <div class="flex flex-wrap gap-2 ml-11">
                    <button onclick="askQuestion('How can I improve my cholesterol levels?')" 
                            class="bg-blue-100 text-blue-700 px-3 py-2 rounded-full text-sm hover:bg-blue-200 transition-colors">
                        üíä Improve cholesterol
                    </button>
                    <button onclick="askQuestion('What exercises are good for my heart?')" 
                            class="bg-green-100 text-green-700 px-3 py-2 rounded-full text-sm hover:bg-green-200 transition-colors">
                        ‚ù§Ô∏è Heart exercises
                    </button>
                    <button onclick="askQuestion('How often should I check my blood pressure?')" 
                            class="bg-purple-100 text-purple-700 px-3 py-2 rounded-full text-sm hover:bg-purple-200 transition-colors">
                        ü©∫ Blood pressure
                    </button>
                </div>
            `;
                chatHistory = [];
            }

            // Collapsible sections functionality
            function toggleSection(sectionId) {
                const content = document.getElementById(sectionId + '-content');
                const icon = document.getElementById(sectionId + '-icon');

                if (content.classList.contains('hidden')) {
                    content.classList.remove('hidden');
                    icon.style.transform = 'rotate(180deg)';
                } else {
                    content.classList.add('hidden');
                    icon.style.transform = 'rotate(0deg)';
                }
            }

            // Navigation and popup functions
            function toggleNotifications() {
                const dropdown = document.getElementById('notificationDropdown');
                const profileDropdown = document.getElementById('profileDropdown');

                // Close profile dropdown if open
                profileDropdown.classList.add('hidden');

                // Toggle notifications dropdown
                dropdown.classList.toggle('hidden');
            }

            function toggleProfile() {
                const dropdown = document.getElementById('profileDropdown');
                const notificationDropdown = document.getElementById('notificationDropdown');

                // Close notification dropdown if open
                notificationDropdown.classList.add('hidden');

                // Toggle profile dropdown
                dropdown.classList.toggle('hidden');
            }

            function markAllRead() {
                // Remove notification badges
                const badges = document.querySelectorAll('.w-2.h-2.bg-blue-500, .w-2.h-2.bg-yellow-500, .w-2.h-2.bg-green-500');
                badges.forEach(badge => badge.remove());

                // Update notification count
                const notificationCount = document.querySelector('.bg-red-500.text-white');
                if (notificationCount) {
                    notificationCount.textContent = '0';
                    notificationCount.classList.add('hidden');
                }

                // Close dropdown
                document.getElementById('notificationDropdown').classList.add('hidden');
            }

            function showProfile() {
                document.getElementById('profileDropdown').classList.add('hidden');
                document.getElementById('profilePage').classList.remove('hidden');
            }

            function hideProfile() {
                document.getElementById('profilePage').classList.add('hidden');
            }

            function showAllReminders() {
                document.getElementById('notificationDropdown').classList.add('hidden');
                document.getElementById('profileDropdown').classList.add('hidden');
                document.getElementById('remindersPage').classList.remove('hidden');
            }

            function hideReminders() {
                document.getElementById('remindersPage').classList.add('hidden');
            }

            function openReminderModal() {
                document.getElementById('reminderModal').classList.remove('hidden');
                // Set default date to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('reminderDate').value = today;
                // Set default time to current time + 1 hour
                const now = new Date();
                now.setHours(now.getHours() + 1);
                const timeString = now.toTimeString().slice(0, 5);
                document.getElementById('reminderTime').value = timeString;
            }

            function closeReminderModal() {
                document.getElementById('reminderModal').classList.add('hidden');
                // Reset form
                document.getElementById('reminderForm').reset();
            }

            function saveReminder() {
                const form = document.getElementById('reminderForm');
                const formData = new FormData(form);

                // Get form values
                const title = document.getElementById('reminderTitle').value;
                const type = document.getElementById('reminderType').value;
                const date = document.getElementById('reminderDate').value;
                const time = document.getElementById('reminderTime').value;
                const frequency = document.getElementById('reminderFrequency').value;
                const description = document.getElementById('reminderDescription').value;
                const priority = document.querySelector('input[name="priority"]:checked').value;

                // Validate required fields
                if (!title || !type || !date || !time) {
                    alert('Please fill in all required fields.');
                    return;
                }

                // Create reminder object
                const reminder = {
                    id: Date.now(),
                    title,
                    type,
                    date,
                    time,
                    frequency,
                    description,
                    priority,
                    status: 'pending'
                };

                // Add to reminders list (in a real app, this would save to database)
                addReminderToList(reminder);

                // Close modal and show success message
                closeReminderModal();
                showSuccessMessage('Reminder added successfully!');
            }

            function addReminderToList(reminder) {
                const remindersGrid = document.querySelector('#remindersPage .grid');
                const reminderCard = createReminderCard(reminder);

                // Insert before the footer spacing
                const footerSpacing = remindersGrid.querySelector('.h-8');
                remindersGrid.insertBefore(reminderCard, footerSpacing);
            }

            function createReminderCard(reminder) {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-sm border p-6';
                card.setAttribute('data-type', reminder.type);
                card.setAttribute('data-id', reminder.id);

                const typeEmoji = {
                    'test': 'üß™',
                    'medicine': 'üíä',
                    'lifestyle': 'üßò',
                    'appointment': 'üè•'
                };

                const priorityColor = {
                    'low': 'bg-gray-100 text-gray-800',
                    'medium': 'bg-yellow-100 text-yellow-800',
                    'high': 'bg-red-100 text-red-800'
                };

                const formatDate = (dateStr) => {
                    const date = new Date(dateStr);
                    const today = new Date();
                    const diffTime = date - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    if (diffDays === 0) return 'Today';
                    if (diffDays === 1) return 'Tomorrow';
                    if (diffDays > 1) return `${diffDays} days`;
                    return 'Overdue';
                };

                card.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-semibold text-gray-900">${reminder.title}</h3>
                    <span class="px-2 py-1 ${priorityColor[reminder.priority]} text-xs rounded-full">${formatDate(reminder.date)}</span>
                </div>
                <div class="space-y-2 mb-4">
                    <p class="text-sm text-gray-600"><i class="fas fa-clock mr-2"></i>${reminder.time}</p>
                    <p class="text-sm text-gray-600"><i class="fas fa-tag mr-2"></i>${typeEmoji[reminder.type]} ${reminder.type.charAt(0).toUpperCase() + reminder.type.slice(1)}</p>
                    ${reminder.description ? `<p class="text-sm text-gray-600">${reminder.description}</p>` : ''}
                    ${reminder.frequency !== 'once' ? `<p class="text-sm text-blue-600"><i class="fas fa-repeat mr-2"></i>${reminder.frequency.charAt(0).toUpperCase() + reminder.frequency.slice(1)}</p>` : ''}
                </div>
                <div class="flex space-x-2">
                    <button onclick="markReminderDone(${reminder.id})" class="flex-1 bg-green-600 text-white py-2 px-3 rounded-lg text-sm hover:bg-green-700">
                        <i class="fas fa-check mr-1"></i>Done
                    </button>
                    <button onclick="editReminder(${reminder.id})" class="flex-1 bg-gray-200 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-300">
                        <i class="fas fa-edit mr-1"></i>Edit
                    </button>
                    <button onclick="deleteReminder(${reminder.id})" class="bg-red-100 text-red-600 py-2 px-3 rounded-lg text-sm hover:bg-red-200">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;

                return card;
            }

            function markReminderDone(id) {
                const card = document.querySelector(`[data-id="${id}"]`);
                if (card) {
                    card.style.opacity = '0.6';
                    const doneButton = card.querySelector('button[onclick^="markReminderDone"]');
                    doneButton.innerHTML = '<i class="fas fa-check mr-1"></i>Completed';
                    doneButton.className = 'flex-1 bg-gray-300 text-gray-600 py-2 px-3 rounded-lg text-sm cursor-not-allowed';
                    doneButton.disabled = true;
                    showSuccessMessage('Reminder marked as completed!');
                }
            }

            function editReminder(id) {
                // In a real app, this would populate the modal with existing data
                showSuccessMessage('Edit functionality would open the modal with existing data!');
            }

            function deleteReminder(id) {
                if (confirm('Are you sure you want to delete this reminder?')) {
                    const card = document.querySelector(`[data-id="${id}"]`);
                    if (card) {
                        card.remove();
                        showSuccessMessage('Reminder deleted successfully!');
                    }
                }
            }

            function showSuccessMessage(message) {
                // Create and show a temporary success message
                const successDiv = document.createElement('div');
                successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300';
                successDiv.innerHTML = `<i class="fas fa-check mr-2"></i>${message}`;
                document.body.appendChild(successDiv);

                setTimeout(() => {
                    successDiv.style.transform = 'translateX(100%)';
                    setTimeout(() => successDiv.remove(), 300);
                }, 3000);
            }

            // Enhanced reminder management functions
            let subtaskCounter = 0;

            function useTemplate(templateType) {
                const templateDropdown = document.getElementById('templateDropdown');
                templateDropdown.classList.toggle('hidden');
            }

            function applyTemplate(templateType) {
                const templates = {
                    'monthly-checkup': {
                        title: 'Monthly Health Checkup',
                        type: 'appointment',
                        description: 'Regular monthly health examination',
                        priority: 'medium',
                        subtasks: ['Schedule appointment', 'Prepare health questions', 'Bring insurance card']
                    },
                    'daily-medicine': {
                        title: 'Daily Medication',
                        type: 'medicine',
                        description: 'Take daily prescribed medication',
                        priority: 'high',
                        frequency: 'daily',
                        subtasks: ['Check medication supply', 'Take with food if required']
                    },
                    'weekly-exercise': {
                        title: 'Weekly Exercise Routine',
                        type: 'lifestyle',
                        description: '30-minute workout session',
                        priority: 'medium',
                        frequency: 'weekly',
                        subtasks: ['Prepare workout clothes', 'Warm up exercises', 'Cool down stretches']
                    },
                    'lab-test': {
                        title: 'Laboratory Test',
                        type: 'test',
                        description: 'Blood work and lab analysis',
                        priority: 'high',
                        subtasks: ['Fast 12 hours before', 'Bring ID and insurance', 'Arrive 15 minutes early']
                    }
                };

                const template = templates[templateType];
                if (template) {
                    document.getElementById('reminderTitle').value = template.title;
                    document.getElementById('reminderType').value = template.type;
                    document.getElementById('reminderDescription').value = template.description;

                    // Set priority
                    const priorityRadio = document.querySelector(`input[name="priority"][value="${template.priority}"]`);
                    if (priorityRadio) priorityRadio.checked = true;

                    // Set frequency if applicable
                    if (template.frequency) {
                        document.getElementById('recurrenceToggle').checked = true;
                        toggleRecurrence();
                        document.getElementById('reminderFrequency').value = template.frequency;
                    }

                    // Add subtasks
                    const subtasksList = document.getElementById('subtasksList');
                    subtasksList.innerHTML = '';
                    template.subtasks.forEach(subtask => {
                        addSubtaskWithText(subtask);
                    });
                }

                // Hide template dropdown
                document.getElementById('templateDropdown').classList.add('hidden');
            }

            function toggleRecurrence() {
                const toggle = document.getElementById('recurrenceToggle');
                const options = document.getElementById('recurrenceOptions');

                if (toggle.checked) {
                    options.classList.remove('hidden');
                } else {
                    options.classList.add('hidden');
                }
            }

            function toggleTwoStep() {
                const toggle = document.getElementById('twoStepToggle');
                const options = document.getElementById('twoStepOptions');

                if (toggle.checked) {
                    options.classList.remove('hidden');
                } else {
                    options.classList.add('hidden');
                }
            }

            function toggleLocation() {
                const toggle = document.getElementById('locationToggle');
                const options = document.getElementById('locationOptions');

                if (toggle.checked) {
                    options.classList.remove('hidden');
                } else {
                    options.classList.add('hidden');
                }
            }

            function addSubtask() {
                addSubtaskWithText('');
            }

            function addSubtaskWithText(text) {
                subtaskCounter++;
                const subtasksList = document.getElementById('subtasksList');
                const subtaskDiv = document.createElement('div');
                subtaskDiv.className = 'flex items-center space-x-2';
                subtaskDiv.innerHTML = `
                <input type="text" placeholder="Enter subtask..." value="${text}" 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <button type="button" onclick="removeSubtask(this)" class="text-red-500 hover:text-red-700 p-1">
                    <i class="fas fa-times"></i>
                </button>
            `;
                subtasksList.appendChild(subtaskDiv);
            }

            function removeSubtask(button) {
                button.parentElement.remove();
            }

            function updateTypeIcon() {
                // This function could update UI based on selected type
                console.log('Type updated');
            }

            function filterReminders(type) {
                // Update active tab
                const tabs = document.querySelectorAll('button[onclick^="filterReminders"]');
                tabs.forEach(tab => {
                    tab.className = 'px-4 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-gray-900';
                });
                event.target.className = 'px-4 py-2 rounded-md text-sm font-medium bg-white text-gray-900 shadow-sm';

                // Filter cards
                const cards = document.querySelectorAll('[data-type]');
                cards.forEach(card => {
                    if (type === 'all' || card.getAttribute('data-type') === type) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            function filterByStatus() {
                const statusFilter = document.getElementById('statusFilter').value;
                const cards = document.querySelectorAll('[data-status]');

                cards.forEach(card => {
                    const cardStatus = card.getAttribute('data-status');
                    if (statusFilter === 'all' || cardStatus === statusFilter) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            function sortReminders() {
                const sortValue = document.getElementById('sortFilter').value;
                const container = document.getElementById('gridView');
                const cards = Array.from(container.children);

                cards.sort((a, b) => {
                    switch (sortValue) {
                        case 'title':
                            const titleA = a.querySelector('h3').textContent;
                            const titleB = b.querySelector('h3').textContent;
                            return titleA.localeCompare(titleB);
                        case 'priority':
                            const priorityOrder = {'high': 3, 'medium': 2, 'low': 1};
                            const priorityA = priorityOrder[a.getAttribute('data-priority')] || 0;
                            const priorityB = priorityOrder[b.getAttribute('data-priority')] || 0;
                            return priorityB - priorityA;
                        case 'type':
                            const typeA = a.getAttribute('data-type');
                            const typeB = b.getAttribute('data-type');
                            return typeA.localeCompare(typeB);
                        default:
                            return 0;
                    }
                });

                // Re-append sorted cards
                cards.forEach(card => container.appendChild(card));
            }

            function toggleView(viewType) {
                const gridView = document.getElementById('gridView');
                const listView = document.getElementById('listView');
                const gridBtn = document.getElementById('gridViewBtn');
                const listBtn = document.getElementById('listViewBtn');

                if (viewType === 'grid') {
                    gridView.classList.remove('hidden');
                    listView.classList.add('hidden');
                    gridBtn.className = 'px-3 py-1 rounded-md text-sm font-medium bg-white text-gray-900 shadow-sm';
                    listBtn.className = 'px-3 py-1 rounded-md text-sm font-medium text-gray-600 hover:text-gray-900';
                } else {
                    gridView.classList.add('hidden');
                    listView.classList.remove('hidden');
                    listBtn.className = 'px-3 py-1 rounded-md text-sm font-medium bg-white text-gray-900 shadow-sm';
                    gridBtn.className = 'px-3 py-1 rounded-md text-sm font-medium text-gray-600 hover:text-gray-900';

                    // Populate list view
                    populateListView();
                }
            }

            function populateListView() {
                const listView = document.getElementById('listView');
                const cards = document.querySelectorAll('#gridView > div[data-type]');

                listView.innerHTML = '';

                cards.forEach(card => {
                    const title = card.querySelector('h3').textContent;
                    const type = card.getAttribute('data-type');
                    const status = card.getAttribute('data-status');
                    const priority = card.getAttribute('data-priority');

                    const typeEmoji = {
                        'test': 'üß™',
                        'medicine': 'üíä',
                        'lifestyle': 'üßò',
                        'appointment': 'üè•'
                    };

                    const priorityColor = {
                        'low': 'bg-green-100 text-green-800',
                        'medium': 'bg-yellow-100 text-yellow-800',
                        'high': 'bg-red-100 text-red-800'
                    };

                    const listItem = document.createElement('div');
                    listItem.className = 'bg-white rounded-lg shadow-sm border p-4 hover:shadow-md transition-shadow duration-200';
                    listItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center">
                                <span>${typeEmoji[type]}</span>
                            </div>
                            <div>
                                <h4 class="font-medium text-gray-900">${title}</h4>
                                <div class="flex items-center space-x-2 mt-1">
                                    <span class="px-2 py-1 ${priorityColor[priority]} text-xs rounded-full">${priority.charAt(0).toUpperCase() + priority.slice(1)}</span>
                                    <span class="text-xs text-gray-500">${type.charAt(0).toUpperCase() + type.slice(1)}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                <i class="fas fa-check mr-1"></i>Done
                            </button>
                            <button class="bg-gray-200 text-gray-700 px-3 py-1 rounded text-sm hover:bg-gray-300">
                                <i class="fas fa-edit mr-1"></i>Edit
                            </button>
                        </div>
                    </div>
                `;

                    listView.appendChild(listItem);
                });
            }

            function toggleReminderMenu(id) {
                const menu = document.getElementById(`reminderMenu${id}`);
                // Close all other menus
                document.querySelectorAll('[id^="reminderMenu"]').forEach(m => {
                    if (m !== menu) m.classList.add('hidden');
                });
                menu.classList.toggle('hidden');
            }

            function snoozeReminder(id) {
                const options = ['15 minutes', '1 hour', '4 hours', '1 day'];
                const choice = prompt(`Snooze reminder for:\n${options.map((opt, i) => `${i + 1}. ${opt}`).join('\n')}\n\nEnter number (1-4):`);

                if (choice && choice >= 1 && choice <= 4) {
                    showSuccessMessage(`Reminder snoozed for ${options[choice - 1]}!`);
                }
            }

            function duplicateReminder(id) {
                showSuccessMessage('Reminder duplicated successfully!');
            }

            function undoCompletion(id) {
                const card = document.querySelector(`[data-id="${id}"]`) || document.querySelector(`#reminderMenu${id}`).closest('[data-type]');
                if (card) {
                    card.style.opacity = '1';
                    card.setAttribute('data-status', 'upcoming');
                    showSuccessMessage('Reminder marked as pending!');
                }
            }

            // Close dropdowns and modals when clicking outside
            document.addEventListener('click', function (event) {
                const notificationDropdown = document.getElementById('notificationDropdown');
                const profileDropdown = document.getElementById('profileDropdown');
                const reminderModal = document.getElementById('reminderModal');
                const notificationButton = event.target.closest('button[onclick="toggleNotifications()"]');
                const profileButton = event.target.closest('button[onclick="toggleProfile()"]');
                const modalContent = event.target.closest('.bg-white.rounded-xl.shadow-xl');

                if (!notificationButton && !notificationDropdown.contains(event.target)) {
                    notificationDropdown.classList.add('hidden');
                }

                if (!profileButton && !profileDropdown.contains(event.target)) {
                    profileDropdown.classList.add('hidden');
                }

                // Close modal when clicking on overlay (but not on modal content)
                if (event.target === reminderModal && !modalContent) {
                    closeReminderModal();
                }
            });

            // Close modal with Escape key
            document.addEventListener('keydown', function (event) {
                if (event.key === 'Escape') {
                    const reminderModal = document.getElementById('reminderModal');
                    if (!reminderModal.classList.contains('hidden')) {
                        closeReminderModal();
                    }
                }
            });
        </script>
        <script>(function () {function c() {var b = a.contentDocument || a.contentWindow.document; if (b) {var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9621474881162772',t:'MTc1MzAwMjEzNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d)} } if (document.body) {var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else {var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) {e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c())}} } })();</script>
</body>

</html>